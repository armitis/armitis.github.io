<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>ç¾å›¢MOMAå›¢é˜Ÿ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ç¾å›¢CRMç§»åŠ¨ç«¯å›¢é˜ŸæŠ€æœ¯åšå®¢">
<meta property="og:type" content="website">
<meta property="og:title" content="ç¾å›¢MOMAå›¢é˜Ÿ">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ç¾å›¢MOMAå›¢é˜Ÿ">
<meta property="og:description" content="ç¾å›¢CRMç§»åŠ¨ç«¯å›¢é˜ŸæŠ€æœ¯åšå®¢">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ç¾å›¢MOMAå›¢é˜Ÿ">
<meta name="twitter:description" content="ç¾å›¢CRMç§»åŠ¨ç«¯å›¢é˜ŸæŠ€æœ¯åšå®¢">
  
    <link rel="alternative" href="/atom.xml" title="ç¾å›¢MOMAå›¢é˜Ÿ" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/pics/icon.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">MOMA</a></h1>
		</hgroup>

		
		<p class="header-subtitle">ç¾å›¢CRMç§»åŠ¨ç«¯å›¢é˜ŸæŠ€æœ¯åšå®¢</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>èœå•</li>
						<li>æ¨™ç±¤</li>
						
						
						<li>é—œæ–¼</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">ä¸»é¡µ</a></li>
				        
							<li><a href="/archives">æ‰€æœ‰æ–‡ç« </a></li>
				        
							<li><a href="/tags/iOS">iOS</a></li>
				        
							<li><a href="/#">android</a></li>
				        
							<li><a href="/#">javaScript</a></li>
				        
							<li><a href="/tags/git">git</a></li>
				        
							<li><a href="/tags/RN">RN</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/RN/" style="font-size: 10px;">RN</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">ç¾å›¢CRMç§»åŠ¨ç«¯å›¢é˜ŸæŠ€æœ¯åšå®¢</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">MOMA</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/pics/icon.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">MOMA</h1>
			</hgroup>
			
			<p class="header-subtitle">ç¾å›¢CRMç§»åŠ¨ç«¯å›¢é˜ŸæŠ€æœ¯åšå®¢</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">ä¸»é¡µ</a></li>
		        
					<li><a href="/archives">æ‰€æœ‰æ–‡ç« </a></li>
		        
					<li><a href="/tags/iOS">iOS</a></li>
		        
					<li><a href="/#">android</a></li>
		        
					<li><a href="/#">javaScript</a></li>
		        
					<li><a href="/tags/git">git</a></li>
		        
					<li><a href="/tags/RN">RN</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-Method Swizzleçš„å±æœº" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/08/03/Method Swizzleçš„å±æœº/" class="article-date">
  	<time datetime="2017-08-03T08:28:00.000Z" itemprop="datePublished">2017-08-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/03/Method Swizzleçš„å±æœº/">Method Swizzleçš„å±æœº</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>åœ¨åŒæ—¶ä½¿ç”¨RACå’ŒAspectsçš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªCrashï¼Œæ ˆæº¢å‡ºäº†ã€‚</p>
<p>çœ‹äº†ä¸€ä¸‹ï¼Œæ˜¯ä¹‹å‰åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†RACçš„rac_singalForSelector</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@weakify(self);&#10;[[viewController rac_signalForSelector:@selector(viewDidAppear:)] subscribeNext&#10;:^(id x) &#123;&#10;      @strongify(self);&#10;      self.shouldIgnorePushingViewControllers = NO;&#10;&#125;];</span><br></pre></td></tr></table></figure>
<p>åæ¥ä»–åˆä½¿ç”¨äº†Aspectsåº“ä¸­çš„aspect_hookSelector</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[UIViewController aspect_hookSelector:@selector(viewDidAppear:) withOptions&#10;:AspectPositionAfter usingBlock:^(id&#60;AspectInfo&#62; info, BOOL animated) &#123;&#10;    NSLog(@&#34;AOP: %@ - %d&#34;, [info.instance class], animated);&#10;&#125; error:NULL];</span><br></pre></td></tr></table></figure>
<p>åæ¥å°±ä»”ç»†çœ‹äº†ä¸€ä¸‹ä¸¤è€…çš„å®ç°ï¼Œä»æ¥å£ä¸Šæ¥è¯´ï¼ŒRACçš„rac_singalForSelectorçš„å®ä¾‹å¯¹è±¡æ–¹æ³•Aspectsçš„aspect_hookSelectorç±»å¯¹è±¡æ–¹æ³•ã€‚</p>
<p>ç¬¬ä¸€æ„Ÿè§‰æ˜¯å‰è€…é’ˆå¯¹æ˜¯å®ä¾‹å¯¹è±¡ï¼Œåè€…é’ˆå¯¹çš„æ˜¯ç±»å¯¹è±¡ã€‚ä¸»è¦æ¶‰åŠçš„å…¶å®è¿˜æ˜¯å¯¹è±¡æ¨¡å‹é‡Œçš„ä¸€äº›çŸ¥è¯†ï¼Œæ“ä½œäº†ç±»å¯¹è±¡å’Œå®ä¾‹å¯¹è±¡ä¸­çš„æ•°æ®å¦‚æœå¯¹å¯¹è±¡æ¨¡å‹ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ä¹‹å‰å†™çš„ä¸€ç¯‡Blog:<a href="http://huanshijiushiniu.github.io/2017/07/13/Method%20Swizzle%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B/" target="_blank" rel="external">å¯¹è±¡æ¨¡å‹</a></p>
<p>ç°åœ¨æ¥åˆ†æä¸‹åŸå› ï¼Œä»æºç å…¥æ‰‹ï¼Œå…ˆæ¥å¤§è‡´çœ‹RACç›¸å…³çš„æºç ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static RACSignal *NSObjectRACSignalForSelector(NSObject *self, SEL selector, &#10;                                               Protocol *protocol) &#123;&#10;  //aliasSelector&#26159;&#20026;&#20102;&#21306;&#20998;&#21407;Selector&#65292;RAC&#21152;&#20102;&#33258;&#24049;&#30340;&#21069;&#32512;&#10;&#9;SEL aliasSelector = RACAliasForSelector(selector);&#10;&#10;&#9;@synchronized (self) &#123;&#10;         //&#36825;&#37324;&#26159;&#26681;&#25454;aliasSelector&#33719;&#24471;&#30456;&#24212;&#30340;&#20919;&#20449;&#21495;&#65292;&#36825;&#20010;&#20919;&#20449;&#21495;&#20027;&#35201;&#26159;&#29992;&#20110;&#36890;&#30693;&#19994;&#21153;&#23618;&#30340;&#22238;&#35843;&#10;         //&#20063;&#23601;&#26159;subscribeNext&#21518;&#38754;&#37027;&#19968;&#27573;block&#10;&#9;&#9;RACSubject *subject = objc_getAssociatedObject(self&#10;                                                       , aliasSelector);&#10;&#9;&#9;if (subject != nil) return subject;&#10;&#10;         //&#36825;&#20010;&#22320;&#26041;&#26159;&#22522;&#20110;&#24403;&#21069;self&#31867;&#21019;&#24314;&#20102;&#19968;&#20010;&#26032;&#31867;&#22411;&#65292;&#26377;&#24456;&#22810;hook&#30340;&#36923;&#36753;&#37117;&#25918;&#22312;&#36825;&#20010;&#31867;&#22411;&#20013;&#10;         //&#20855;&#20307;&#36923;&#36753;&#22312;RACSwizzleClass&#20989;&#25968;&#20013;&#20877;&#20998;&#26512;&#10;&#9;&#9;Class class = RACSwizzleClass(self);&#10;&#9;&#9;NSCAssert(class != nil, @&#34;Could not swizzle class of %@&#34;, self);&#10;&#10;         //&#21019;&#24314;&#19968;&#20010;&#29992;&#20110;&#36890;&#30693;&#30340;&#20919;&#20449;&#21495;&#10;&#9;&#9;subject = [[RACSubject subject] setNameWithFormat:@&#34;%@ &#10;                   -rac_signalForSelector: %s&#34;, &#10;                   self.rac_description, &#10;                   sel_getName(selector)];&#10;&#10;         //&#36890;&#36807;&#20851;&#32852;&#23545;&#35937;&#30340;&#26041;&#24335;&#23384;&#20648;&#20919;&#20449;&#21495;&#10;&#9;&#9;objc_setAssociatedObject(self, &#10;                                 aliasSelector, &#10;                                 subject, &#10;                                 OBJC_ASSOCIATION_RETAIN);&#10;&#9;&#9;[self.rac_deallocDisposable addDisposable: &#10;                             [RACDisposable  disposableWithBlock:^&#123;&#10;&#9;&#9;&#9;                      [subject sendCompleted];&#10;&#9;&#9;&#125;]];&#10;&#10;         //targetMethod&#26159;&#34;viewDidApear&#34;&#36825;&#20010;Selector&#30340;&#26041;&#27861;&#23545;&#35937;&#10;&#9;&#9;Method targetMethod = class_getInstanceMethod(class, selector);&#10;&#9;&#9;if (targetMethod == NULL) &#123;&#10;          //&#25353;&#29031;&#29616;&#26377;&#36923;&#36753;&#65292;&#36825;&#37324;&#24212;&#35813;&#26159;&#36208;&#19981;&#21040;&#30340;&#65292;&#20808;&#19981;&#21435;&#30475;&#23427;&#10;&#9;&#9;&#9;const char *typeEncoding;&#10;&#9;&#9;&#9;if (protocol == NULL) &#123;&#10;&#9;&#9;&#9;typeEncoding = RACSignatureForUndefinedSelector(selector);&#10;&#9;&#9;&#9;&#125; else &#123;&#10;&#9;&#9;// Look for the selector as an optional instance method.&#10;&#9;&#9;&#9;&#9;struct objc_method_description methodDescription =&#10;                  protocol_getMethodDescription(protocol, selector, NO, YES);&#10;&#10;&#9;&#9;&#9;&#9;if (methodDescription.name == NULL) &#123;&#10;&#9;&#9;&#9;&#9;// Then fall back to looking for a required &#10;                  //instance method.&#10;&#9;&#9;&#9;&#9;&#9;methodDescription = &#10;                      protocol_getMethodDescription(protocol&#10;                                                    , selector&#10;                                                    , YES&#10;                                                    , YES);&#10;&#9;&#9;&#9;&#9;&#9;NSCAssert(methodDescription.name != NULL&#10;                              , @&#34;Selector %@ does not exist in &#60;%s&#62;&#34;&#10;                              ,NSStringFromSelector(selector)&#10;                              , protocol_getName(protocol));&#10;&#9;&#9;&#9;&#9;&#125;&#10;&#10;&#9;&#9;&#9;&#9;typeEncoding = methodDescription.types;&#10;&#9;&#9;&#9;&#125;&#10;&#10;&#9;&#9;&#9;RACCheckTypeEncoding(typeEncoding);&#10;&#10;&#9;&#9;&#9;// Define the selector to call -forwardInvocation:.&#10;&#9;&#9;&#9;if (!class_addMethod(class, &#10;                                 selector,&#10;                                 _objc_msgForward, &#10;                                 typeEncoding)) &#123;&#10;&#9;&#9;&#9;&#9;NSDictionary *userInfo = @&#123;&#10;&#9;&#9;&#9;&#9;&#9;NSLocalizedDescriptionKey: &#10;                                         [NSString stringWithFormat:&#10;                                                NSLocalizedString(&#10;                                                  @&#34;A race condition occurred &#10;                                                  implementing %@ on class %@&#34;&#10;                                                  , nil)&#10;                                                ,NSStringFromSelector(selector)&#10;                                                , class],&#10;&#9;&#9;&#9;&#9;&#9;NSLocalizedRecoverySuggestionErrorKey: &#10;                   NSLocalizedString(@&#34;Invoke -rac_signalForSelector: &#10;                                     again to override the implementation.&#34;, nil)&#10;&#9;&#9;&#9;&#9;&#125;;&#10;&#10;&#9;&#9;&#9;&#9;return [RACSignal error:[NSError errorWithDomain:&#10;                                         RACSelectorSignalErrorDomain&#10;                                code:RACSelectorSignalErrorMethodSwizzlingRace&#10;                                         userInfo:userInfo]];&#10;&#9;&#9;&#9;&#125;&#10;          //_objc_msgForward&#26159;&#28040;&#24687;&#36827;&#34892;&#36716;&#21457;&#30340;&#24320;&#22987;&#65292;&#36825;&#37324;&#20027;&#35201;&#26159;&#21028;&#26029;&#21407;&#22987;&#30340;&#10;          //&#26041;&#27861;&#23545;&#35937;&#26377;&#27809;&#26377;&#34987;hook&#25104;_objc_msgForward&#65292;&#22240;&#20026;&#19979;&#38754;&#35201;&#24320;&#22987;&#36827;&#34892;&#26041;&#27861;&#23454;&#29616;&#30340;&#26367;&#25442;&#20102;&#10;&#9;&#9;&#125; else if (method_getImplementation(targetMethod) != &#10;                   _objc_msgForward) &#123;&#10;&#9;&#9;&#9;// Make a method alias for the existing &#10;             //method implementation.&#10;&#9;&#9;&#9;const char *typeEncoding =&#10;              method_getTypeEncoding(targetMethod);&#10;&#9;&#9;&#9;RACCheckTypeEncoding(typeEncoding);&#10;             //class_addMethod&#21482;&#26159;&#22312;&#24403;&#21069;&#31867;&#22411;&#23545;&#35937;(&#19981;&#20250;&#21435;&#22522;&#31867;&#20013;&#26597;&#25214;)&#20013;&#10;             //&#21435;&#25214;&#26377;&#27809;&#26377;aliasSelector&#30340;&#26041;&#27861;&#65292;&#22914;&#26524;&#26377;&#23601;&#30452;&#25509;&#36820;&#22238;&#21407;&#26469;&#30340;&#26041;&#27861;&#23454;&#29616;&#10;            //&#22914;&#26524;&#27809;&#26377;&#23601;&#28155;&#21152;&#19968;&#20010;&#10;&#9;&#9;&#9;BOOL addedAlias __attribute__((unused)) = &#10;              class_addMethod(class, aliasSelector, &#10;                              method_getImplementation(targetMethod), &#10;                              typeEncoding);&#10;&#9;&#9;&#9;NSCAssert(addedAlias, @&#34;Original implementation &#10;                      for %@ is already copied to %@ on %@&#34;, &#10;                      NSStringFromSelector(selector), &#10;                      NSStringFromSelector(aliasSelector), class);&#10;&#9;&#9;&#9;// Redefine the selector to call -forwardInvocation:.&#10;             // &#36825;&#37324;&#30456;&#24403;&#20110;&#23545;&#21407;&#22987;&#26041;&#27861;&#36827;&#34892;&#26041;&#27861;&#23454;&#29616;&#30340;&#26367;&#25442;&#65292;&#10;             //&#21482;&#35201;&#35843;&#29992;&#21407;&#22987;&#26041;&#27861;&#65292;&#30452;&#25509;&#20250;&#24320;&#22987;&#26041;&#27861;&#36716;&#21457;&#30340;&#36807;&#31243;&#10;&#9;&#9;&#9;class_replaceMethod(class&#10;                                , selector&#10;                                , _objc_msgForward,&#10;                                method_getTypeEncoding(targetMethod));&#10;&#9;&#9;&#125;&#10;&#10;&#9;&#9;return subject;&#10;&#9;&#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡åŸå§‹è‹±æ–‡æ³¨é‡ŠåŠ ä¸Šåæ¥çš„ä¸­æ–‡æ³¨é‡Šåº”è¯¥èƒ½æ¯”è¾ƒå¥½çš„ç†è§£å¤§è‡´çš„è¿‡ç¨‹äº†</p>
<p>åˆ†ä¸º2éƒ¨åˆ†</p>
<p>1æ˜¯åˆ›å»ºç”¨äºé€šçŸ¥ä¸šåŠ¡å±‚å›è°ƒçš„å†·ä¿¡å·</p>
<p>2æ˜¯Hookäº†å½“å‰ç±»ï¼Œåˆ›å»ºäº†æ–°çš„å­ç±»å‹ï¼Œå¹¶å°†è¿™ä¸ªå­ç±»å‹çš„åŸå§‹selectorè¿›è¡Œäº†æ–¹æ³•å®ç°çš„æ›¿æ¢</p>
<p>æ—¢å°†åŸå§‹selectorå®ç°æ›¿æ¢æˆ_objc_msgForwardï¼Œå¢åŠ äº†ä¸€ä¸ªæ–°çš„selector prefix_selectorï¼Œ</p>
<p>å¹¶å°†å…¶å®ç°ä¸ºåŸå§‹selectorã€‚å¦å¤–ä¸ªäººè§‰å¾—å‘½åä¸Šæœ€å¥½æ˜¯ä¸è¦å«classäº†ï¼Œå¯ä»¥æ”¹ä¸ºsubClassæˆ–è€…</p>
<p>swizzleClassï¼Œå®¹æ˜“è·ŸåŸå§‹classææ··</p>
<p>æ¥ç€å°±æ˜¯RACSwizzleCalsså‡½æ•°äº†ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static Class RACSwizzleClass(NSObject *self) &#123;&#10;  //self.class&#21644;object_getClass&#36820;&#22238;&#30340;&#37117;&#26159;&#24403;&#21069;&#23454;&#20363;&#30340;&#31867;&#23545;&#35937;&#65292;&#22909;&#20687;&#27809;&#20160;&#20040;&#21306;&#21035;???&#10;&#9;Class statedClass = self.class;&#10;&#9;Class baseClass = object_getClass(self);&#10;&#10;&#9;// The &#34;known dynamic subclass&#34; is the subclass generated by RAC.&#10;&#9;// It&#39;s stored as an associated object on every instance that&#39;s already&#10;&#9;// been swizzled, so that even if something else swizzles the class of&#10;&#9;// this instance, we can still access the RAC generated subclass.&#10;    //&#36825;&#37324;&#23448;&#26041;&#35828;&#26126;&#20102;&#23376;&#31867;&#30340;&#29992;&#36884;&#65292;&#22914;&#26524;&#26377;&#20854;&#20182;&#22320;&#26041;swizzle&#20102;&#24403;&#21069;&#31867;&#23545;&#35937;&#65292;&#37027;&#20063;&#19981;&#22826;&#24433;&#21709;RAC&#33258;&#24049;&#30340;&#36923;&#36753;&#10;    //&#22240;&#20026;&#23427;&#25152;&#26377;&#30340;&#20449;&#24687;&#37117;&#20445;&#23384;&#22312;&#33258;&#24049;&#21019;&#24314;&#30340;&#23376;&#31867;&#20013;&#12290;&#10;&#9;Class knownDynamicSubclass = &#10;      objc_getAssociatedObject(self, RACSubclassAssociationKey);&#10;&#9;if (knownDynamicSubclass != Nil) return knownDynamicSubclass;&#10;&#10;&#9;NSString *className = NSStringFromClass(baseClass);&#10;&#10;&#9;if (statedClass != baseClass) &#123;&#10;         //&#36825;&#37096;&#20998;&#36923;&#36753;&#27809;&#36208;&#21040;&#65292;&#20808;&#19981;&#30475;&#10;&#9;&#9;@synchronized (swizzledClasses()) &#123;&#10;&#9;&#9;&#9;if (![swizzledClasses() containsObject:className]) &#123;&#10;&#9;&#9;&#9;&#9;RACSwizzleForwardInvocation(baseClass);&#10;&#9;&#9;&#9;&#9;RACSwizzleRespondsToSelector(baseClass);&#10;&#9;&#9;&#9;&#9;RACSwizzleGetClass(baseClass, statedClass);&#10;&#9;&#9;&#9;&#9;RACSwizzleGetClass(object_getClass(baseClass), &#10;                                   statedClass);&#10;&#9;&#9;&#9;&#9;RACSwizzleMethodSignatureForSelector(baseClass);&#10;&#9;&#9;&#9;&#9;[swizzledClasses() addObject:className];&#10;&#9;&#9;&#9;&#125;&#10;&#9;&#9;&#125;&#10;&#10;&#9;&#9;return baseClass;&#10;&#9;&#125;&#10;     //&#21152;&#19978;RAC&#33258;&#24049;&#30340;&#21069;&#32512;&#65292;&#32473;&#26032;&#30340;&#23376;&#31867;&#21629;&#21517;&#10;&#9;const char *subclassName = [className stringByAppendingString:&#10;                                RACSubclassSuffix].UTF8String;&#10;&#9;Class subclass = objc_getClass(subclassName);&#10;&#10;&#9;if (subclass == nil) &#123;&#10;        //createClass&#37324;&#38754;&#35843;&#29992;&#30340;&#26159;objc_allocateClassPair&#20989;&#25968;&#29992;&#20110;&#21019;&#24314;&#26032;&#30340;&#31867;&#22411;&#23545;&#35937;&#65292;&#10;        //&#23427;&#21644;&#19979;&#38754;&#30340;objc_registerClassPair&#20989;&#25968;&#26159;&#37197;&#23545;&#20351;&#29992;&#30340;&#10;&#9;&#9;subclass = [RACObjCRuntime createClass:subclassName &#10;                    inheritingFromClass:baseClass];&#10;&#9;&#9;if (subclass == nil) return nil;&#10;         //&#36825;&#37324;&#26159;&#23545;&#26032;&#30340;&#23376;&#31867;&#30340;forwardInvocation&#26041;&#27861;hook&#10;&#9;&#9;RACSwizzleForwardInvocation(subclass);&#10;         //hookRespondsToSelector&#26041;&#27861;&#10;&#9;&#9;RACSwizzleRespondsToSelector(subclass);&#10;         //hook&#20102;Class&#26041;&#27861;&#10;&#9;&#9;RACSwizzleGetClass(subclass, statedClass);&#10;         //&#36825;&#37324;object_getClass&#24471;&#21040;&#30340;&#36824;&#26159;statedClass&#65292;&#26082;&#21407;&#22987;&#30340;&#31867;&#12290;&#10;&#9;&#9;RACSwizzleGetClass(object_getClass(subclass), statedClass);&#10;         //hook&#20102;&#26041;&#27861;&#31614;&#21517;&#10;&#9;&#9;RACSwizzleMethodSignatureForSelector(subclass);&#10;&#9;&#9;//&#32467;&#26463;&#23376;&#31867;&#30340;&#21019;&#24314;&#10;&#9;&#9;objc_registerClassPair(subclass);&#10;&#9;&#125;&#10;&#9;//&#36825;&#37324;&#26159;&#23558;&#24403;&#21069;&#23454;&#20363;&#23545;&#35937;&#30340;&#31867;&#22411;&#20449;&#24687;&#25913;&#20889;&#25104;&#26032;&#30340;&#23376;&#31867;&#10;&#9;object_setClass(self, subclass);&#10;    //&#20445;&#23384;&#23376;&#31867;&#20449;&#24687;&#10;&#9;objc_setAssociatedObject(self, RACSubclassAssociationKey, subclass, &#10;                             OBJC_ASSOCIATION_ASSIGN);&#10;&#9;return subclass;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>RACSwizzleCalsså‡½æ•°é‡Œä¸»è¦å¹²çš„äº‹æƒ…å°±æ˜¯åˆ›å»ºå­ç±»å‹ï¼š</p>
<p>1.ç»™æ–°çš„å­ç±»å‹å‘½å</p>
<p>2.hookå‡ ä¸ªé‡è¦çš„æ¶ˆæ¯è½¬å‘æ–¹æ³•ï¼Œ1æ˜¯ä¸ºäº†å¾—åˆ°æ–¹æ³•è°ƒç”¨çš„å…¥å£ 2æ˜¯å°†å­ç±»ä¼ªè£…æˆåŸå§‹çš„ç±»å‹</p>
<p>3.æ”¹å˜äº†å®ä¾‹å¯¹è±¡çš„isaæŒ‡é’ˆä¸ºæ–°çš„å­ç±»ï¼Œå½“å‰å®ä¾‹å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ä¸ºæ–°çš„å­ç±»ä¿¡æ¯</p>
<p>è¿™é‡Œæœ‰å¿…è¦çœ‹ä¸€ä¸‹RACSwizzleGetClasså‡½æ•°çš„å®ç°ï¼š</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">void</span> <span class="type">RACSwizzleGetClass</span>(<span class="type">Class</span> class, <span class="type">Class</span> statedClass) &#123;</span><br><span class="line">	<span class="type">SEL</span> selector = @selector(class);</span><br><span class="line">	<span class="type">Method</span> <span class="keyword">method</span> = class_getInstanceMethod(class, selector);</span><br><span class="line">	<span class="type">IMP</span> newIMP = imp_implementationWithBlock(^(id self) &#123;</span><br><span class="line">	   //å½“è°ƒç”¨å­ç±»çš„classæ–¹æ³•çš„æ—¶å€™ï¼Œè¿”å›çš„è¿˜æ˜¯åŸå§‹ç±»å‹å¯¹è±¡</span><br><span class="line">		<span class="keyword">return</span> statedClass;</span><br><span class="line">	&#125;);</span><br><span class="line">	class_replaceMethod(class</span><br><span class="line">	, selector</span><br><span class="line">	, newIMP</span><br><span class="line">	, method_getTypeEncoding(<span class="keyword">method</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œä½¿ç”¨è€…æ„Ÿè§‰ä¸åˆ°æœ‰ä»€ä¹ˆå¼‚æ ·ï¼Œä¸çŸ¥é“hookçš„å­˜åœ¨äº†</p>
<p>æœ€åé‡ç‚¹çœ‹ä¸€ä¸‹RACSwizzleForwardInvocationå‡½æ•°ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static void RACSwizzleForwardInvocation(Class class) &#123;&#10;&#9;SEL forwardInvocationSEL = @selector(forwardInvocation:);&#10;&#9;Method forwardInvocationMethod = &#10;      class_getInstanceMethod(class&#10;                              , forwardInvocationSEL);&#10;&#10;&#9;// Preserve any existing implementation of -forwardInvocation:.&#10;&#9;void (*originalForwardInvocation)(id, SEL, NSInvocation *) = NULL;&#10;&#9;if (forwardInvocationMethod != NULL) &#123;&#10;&#9;&#9;originalForwardInvocation =&#10;(__typeof__(originalForwardInvocation))method_getImplementation(&#10;          forwardInvocationMethod);&#10;&#9;&#125;&#10;&#10;&#9;// Set up a new version of -forwardInvocation:.&#10;&#9;//&#10;&#9;// If the selector has been passed to -rac_signalForSelector:, invoke&#10;&#9;// the aliased method, and forward the arguments to any attached signals.&#10;&#9;//&#10;&#9;// If the selector has not been passed to -rac_signalForSelector:,&#10;&#9;// invoke any existing implementation of -forwardInvocation:. If there&#10;&#9;// was no existing implementation, throw an unrecognized selector&#10;&#9;// exception.&#10;&#9;id newForwardInvocation = ^(id self, NSInvocation *invocation) &#123;&#10;&#9;&#9;BOOL matched = RACForwardInvocation(self, invocation);&#10;&#9;&#9;if (matched) return;&#10;&#10;&#9;&#9;if (originalForwardInvocation == NULL) &#123;&#10;&#9;&#9;&#9;[self doesNotRecognizeSelector:invocation.selector];&#10;&#9;&#9;&#125; else &#123;&#10;             //&#22914;&#26524;&#36208;&#21040;&#36825;&#37324;&#65292;&#22522;&#26412;&#19978;&#20063;&#35201;&#25243;&#20986;&#24322;&#24120;&#20102;&#65292;&#19968;&#25644;hook&#30340;&#37117;&#26159;&#24517;&#26377;&#30340;&#26041;&#27861;&#65292;&#24050;&#32463;&#32469;&#36807;&#20102;&#10;             //&#21407;&#26469;&#30340;&#26041;&#27861;&#26597;&#25214;&#30340;&#36807;&#31243;&#21040;&#20102;&#28040;&#24687;&#36716;&#21457;&#36825;&#19968;&#27493;&#10;&#9;&#9;&#9;originalForwardInvocation(self, forwardInvocationSEL, &#10;                                      invocation);&#10;&#9;&#9;&#125;&#10;&#9;&#125;;&#10;&#10;&#9;class_replaceMethod(class, forwardInvocationSEL,&#10;                        imp_implementationWithBlock(newForwardInvocation)&#10;                        , &#34;v@:@&#34;);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨newForwardInvocationæ›¿æ¢äº†åŸæ¥çš„forwardInvocationå®ç°ï¼Œé‡Œé¢åˆè°ƒç”¨äº†RACForwardInvocationå‡½æ•°ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static BOOL RACForwardInvocation(id self, NSInvocation *invocation) &#123;&#10;    //&#36825;&#37324;&#30340;invocation&#36824;&#26159;&#21407;&#22987;&#30340;&#26041;&#27861;&#35843;&#29992;&#20449;&#24687;&#65292;&#25163;&#21160;&#25913;&#25104;&#20102;&#24102;&#21069;&#32512;&#30340;selector&#10;&#9;SEL aliasSelector = RACAliasForSelector(invocation.selector);&#10;    //&#33719;&#21462;&#19968;&#19979;&#20043;&#21069;&#23384;&#20648;&#30340;&#20919;&#20449;&#21495;&#10;&#9;RACSubject *subject = objc_getAssociatedObject(self, aliasSelector);&#10;    //&#36825;&#37324;&#30340;class&#24471;&#21040;&#30340;&#26159;RAC&#21019;&#24314;&#30340;&#23376;&#31867;&#65292;&#22240;&#20026;&#20043;&#21069;&#24050;&#32463;&#25913;&#20889;&#20102;&#23454;&#20363;&#23545;&#35937;&#30340;ISA&#25351;&#38024;&#10;&#9;Class class = object_getClass(invocation.target);&#10;&#9;BOOL respondsToAlias = [class instancesRespondToSelector:aliasSelector];&#10;&#9;if (respondsToAlias) &#123;&#10;        //&#21435;&#25913;&#21464;selector&#20026;hook&#30340;&#26032;&#30340;selector&#65292;&#19981;&#28982;&#35201;&#27515;&#24490;&#29615;&#20102;&#10;&#9;&#9;invocation.selector = aliasSelector;&#10;         //&#36825;&#19968;&#27493;&#23601;&#26159;&#30495;&#27491;&#21407;&#22987;&#30340;&#26041;&#27861;&#35843;&#29992;&#20102;&#65292;&#36824;&#35760;&#24471;&#20043;&#21069;&#24050;&#32463;&#25226;aliasSelector&#30340;&#23454;&#29616;&#25913;&#20026;&#10;         //&#21407;&#22987;Selector&#30340;&#23454;&#29616;&#20102;&#21543;&#10;&#9;&#9;[invocation invoke];&#10;&#9;&#125;&#10;&#10;&#9;if (subject == nil) return respondsToAlias;&#10;    //&#36890;&#30693;&#19994;&#21153;&#23618;&#65292;&#35201;&#30417;&#21548;&#30340;selector&#24050;&#32463;&#34987;&#35843;&#29992;&#20102;&#65292;&#36825;&#20010;&#21457;&#29983;&#22312;&#21407;&#22987;&#26041;&#27861;&#35843;&#29992;&#20043;&#21518;&#10;&#9;[subject sendNext:invocation.rac_argumentsTuple];&#10;&#9;return YES;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>å‰é¢å‡ ä¸ªå‡½æ•°éƒ½æ˜¯ä¸ºè¿™ä¸€æ­¥æ‰“åŸºç¡€çš„ï¼Œåˆ°äº†çœŸæ­£æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼ŒåŸå§‹æ–¹æ³•çš„è°ƒç”¨ä»¥åŠé€šçŸ¥ä¸šåŠ¡å±‚å›è°ƒéƒ½åœ¨è¿™é‡Œå®Œæˆã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œç°åœ¨é€šè¿‡ä¸€å¼ å›¾æ€»ç»“ä¸€ä¸‹ï¼š</p>
<p><img src="http://7xqgnx.com1.z0.glb.clouddn.com/RAC%20Swizzle%20Class.png" alt="RAC Swizzle Class"></p>
<p>ç°åœ¨çœ‹ä¸€ä¸‹Aspectsaspect_hookSelectorçš„å®ç°,ä¸»è¦æ˜¯aspect_prepareClassAndHookSelectorå‡½æ•°</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static void aspect_prepareClassAndHookSelector(NSObject *self, SEL selector&#10;                                               , NSError **error) &#123;&#10;    NSCParameterAssert(selector);&#10;   //&#36825;&#37324;&#31561;&#30475;aspect_hookClass&#20855;&#20307;&#20998;&#26512;&#20854;&#36807;&#31243;&#65292;&#26242;&#26102;&#26469;&#30475;&#26159;&#29983;&#25104;&#20102;&#26032;&#23376;&#31867;&#10;    Class klass = aspect_hookClass(self, error);&#10;   //&#33719;&#24471;&#21407;&#22987;&#26041;&#27861;&#23545;&#35937;&#10;    Method targetMethod = class_getInstanceMethod(klass, selector);&#10;    IMP targetMethodIMP = method_getImplementation(targetMethod);&#10;    if (!aspect_isMsgForwardIMP(targetMethodIMP)) &#123;&#10;        // Make a method alias for the existing method implementation, &#10;        //it not already copied.&#10;        const char *typeEncoding = method_getTypeEncoding(targetMethod);&#10;        SEL aliasSelector = aspect_aliasForSelector(selector);&#10;        if (![klass instancesRespondToSelector:aliasSelector]) &#123;&#10;          //&#28155;&#21152;alias&#26041;&#27861;&#65292;&#23454;&#29616;&#20026;&#21407;&#26041;&#27861;&#23454;&#29616;&#10;            __unused BOOL addedAlias = &#10;              class_addMethod(klass            &#10;                              , aliasSelector                &#10;                              ,method_getImplementation(targetMethod)         &#10;                              ,typeEncoding);&#10;            NSCAssert(addedAlias, @&#34;Original implementation for %@ is already &#10;                      copied to %@ on %@&#34;, NSStringFromSelector(selector),&#10;                      NSStringFromSelector(aliasSelector), klass);&#10;        &#125;&#10;&#10;        // We use forwardInvocation to hook in.&#10;        //&#36825;&#37324;&#36319;RAC&#19968;&#26679;&#30340;&#20570;&#27861;&#65292;&#25226;&#21407;&#26041;&#27861;&#23454;&#29616;&#25442;&#25104;&#20102;_objc_msgForward&#10;        //&#35843;&#21407;&#26041;&#27861;&#20250;&#30452;&#25509;&#24320;&#22987;&#28040;&#24687;&#36716;&#21457;&#30340;&#36807;&#31243;&#10;        class_replaceMethod(klass&#10;                            , selector&#10;                            , aspect_getMsgForwardIMP(self, selector)&#10;                            ,typeEncoding);&#10;        AspectLog(@&#34;Aspects: Installed hook for -[%@ %@].&#34;, klass,&#10;                  NSStringFromSelector(selector));&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>å¤§è‡´ä¸Šæ¥çœ‹ï¼Œåœ¨æ–¹æ³•å®ç°çš„å±‚é¢çš„å¤„ç†å’ŒRACå¾ˆç±»ä¼¼.å®é™…è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œaspect_hookClassæœ€ç»ˆåªæ˜¯è°ƒç”¨äº†aspect_swizzleClassInPlaceï¼Œç„¶åaspect_swizzleClassInPlaceå…¶å®è°ƒç”¨äº†aspect_swizzleForwardInvocationç°åœ¨æ¥çœ‹ä¸€ä¸‹aspect_swizzleForwardInvocationå‡½æ•°ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static void aspect_swizzleForwardInvocation(Class klass) &#123;&#10;    NSCParameterAssert(klass);&#10;    // If there is no method, replace will act like class_addMethod.&#10;    //&#23558;forwardInvocation&#26041;&#27861;&#23454;&#29616;&#26367;&#25442;&#25104;&#20102;__ASPECTS_ARE_BEING_CALLED__&#10;    IMP originalImplementation = class_replaceMethod(klass&#10;                                          ,@selector(forwardInvocation:)&#10;                                          ,(IMP)__ASPECTS_ARE_BEING_CALLED__&#10;                                           ,&#34;v@:@&#34;);&#10;    if (originalImplementation) &#123;&#10;     //alias&#30340;forwardInvocation&#25442;&#25104;&#20102;&#21407;&#22987;&#23454;&#29616;&#10;        class_addMethod(klass, &#10;                        NSSelectorFromString(AspectsForwardInvocationSelectorName),&#10;                        originalImplementation, &#34;v@:@&#34;);&#10;    &#125;&#10;    AspectLog(@&#34;Aspects: %@ is now aspect aware.&#34;, NSStringFromClass(klass));&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ¶ˆæ¯è½¬å‘çš„æœ€åå…³å¤´ï¼Œè°ƒç”¨ASPECTS_ARE_BEING_CALLED</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static void __ASPECTS_ARE_BEING_CALLED__(__unsafe_unretained NSObject *self, &#10;                                         SEL selector, &#10;                                         NSInvocation *invocation) &#123;&#10;    NSCParameterAssert(self);&#10;    NSCParameterAssert(invocation);&#10;    SEL originalSelector = invocation.selector;&#10;    //&#24471;&#21040;&#30456;&#24212;&#30340;aliasSelector&#10;&#9;SEL aliasSelector = aspect_aliasForSelector(invocation.selector);&#10;    //&#26367;&#25442;selector&#65292;&#22240;&#20026;invocation&#20013;&#30340;selector&#36824;&#26159;&#21407;&#22987;&#30340;selector&#10;    //&#19981;&#28982;&#36882;&#24402;&#27515;&#24490;&#29615;&#36319;RAC&#19968;&#26679;&#10;    invocation.selector = aliasSelector;&#10;    //&#36890;&#36807;aliasSelector&#24471;&#21040;hook&#30340;&#29992;&#25143;&#22238;&#35843;&#10;    AspectsContainer *objectContainer = objc_getAssociatedObject(self, &#10;                                                                 aliasSelector);&#10;    AspectsContainer *classContainer = aspect_getContainerForClass(&#10;      object_getClass(self), &#10;      aliasSelector);&#10;    AspectInfo *info = [[AspectInfo alloc] initWithInstance:self &#10;                        invocation:invocation];&#10;    NSArray *aspectsToRemove = nil;&#10;&#10;    // Before hooks.&#10;   //&#35302;&#21457;&#37027;&#20123;&#22312;&#21407;&#22987;&#36923;&#36753;&#35843;&#29992;&#20043;&#21069;&#30340;&#22238;&#35843;&#10;    aspect_invoke(classContainer.beforeAspects, info);&#10;    aspect_invoke(objectContainer.beforeAspects, info);&#10;&#10;    // Instead hooks.&#10;    BOOL respondsToAlias = YES;&#10;    if (objectContainer.insteadAspects.count || &#10;        classContainer.insteadAspects.count) &#123;&#10;          //&#30452;&#25509;&#26159;&#22238;&#35843;&#26367;&#25442;&#21407;&#22987;&#23454;&#29616;&#20102;&#10;        aspect_invoke(classContainer.insteadAspects, info);&#10;        aspect_invoke(objectContainer.insteadAspects, info);&#10;    &#125;else &#123;&#10;        Class klass = object_getClass(invocation.target);&#10;        do &#123;&#10;            if ((respondsToAlias = [klass instancesRespondToSelector:&#10;                                    aliasSelector])) &#123;&#10;                //&#36825;&#37324;&#26159;&#35302;&#21457;&#21407;&#22987;&#26041;&#27861;&#30340;&#23454;&#29616;&#10;                [invocation invoke];&#10;                break;&#10;            &#125;&#10;        &#125;while (!respondsToAlias &#38;&#38; (klass = class_getSuperclass(klass)));&#10;    &#125;&#10;&#10;    // After hooks.&#10;    //&#35302;&#21457;&#37027;&#20123;&#22312;&#21407;&#22987;&#26041;&#27861;&#35843;&#29992;&#20043;&#21518;&#30340;&#29992;&#25143;&#22238;&#35843;&#10;    aspect_invoke(classContainer.afterAspects, info);&#10;    aspect_invoke(objectContainer.afterAspects, info);&#10;&#10;    // If no hooks are installed, call original implementation (usually &#10;    //to throw an exception)&#10;    if (!respondsToAlias) &#123;&#10;        invocation.selector = originalSelector;&#10;        SEL originalForwardInvocationSEL =&#10;          NSSelectorFromString(AspectsForwardInvocationSelectorName);&#10;        if ([self respondsToSelector:originalForwardInvocationSEL]) &#123;&#10;            ((void( *)(id, SEL, NSInvocation *))objc_msgSend)(self, &#10;                                           originalForwardInvocationSEL,&#10;                                                              invocation);&#10;        &#125;else &#123;&#10;            [self doesNotRecognizeSelector:invocation.selector];&#10;        &#125;&#10;    &#125;&#10;&#10;    // Remove any hooks that are queued for deregistration.&#10;    [aspectsToRemove makeObjectsPerformSelector:@selector(remove)];&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹æ ·å­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹Aå¹¶æ²¡æœ‰æƒ³RACä¸€æ ·åˆ›å»ºæ–°çš„å­ç±»å‹ï¼Œå®ƒæ˜¯ç›´æ¥æ›´æ”¹äº†åŸå§‹ç±»å‹çš„æ–¹æ³•ä¿¡æ¯ã€‚</p>
<p>ç”¨å›¾æ¥è¡¨ç¤ºä¸€ä¸‹å®ƒå½“å‰çš„å®ç°ï¼š</p>
<p><img src="http://7xqgnx.com1.z0.glb.clouddn.com/Aheater_Hook.png" alt="Aspects Hook"></p>
<p>å’ŒRACæ¯”è¦ç®€å•ä¸€äº›ï¼Œé‚£ä¹ˆå½“åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªåº“Hookçš„æ—¶å€™ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼ŸæŒ‰ç…§æ–‡ç« å¼€å¤´çš„åœºæ™¯ï¼ŒRACç›¸å½“äºHookäº†æŸä¸ªç»§æ‰¿è‡ªUIViewControllerçš„å­ç±»,å¹¶åŸºäºè¯¥å­ç±»åˆ›å»ºäº†æ–°çš„å­ç±»å‹Aspectsç›¸å½“äºç›´æ¥Hookäº†UIViewControllerï¼Œå¯¹UIViewControlleræœ¬èº«çš„æ–¹æ³•å®ç°è¿›è¡Œäº†æ›´æ”¹æ›¿æ¢ç°åœ¨å‡è®¾ç»§æ‰¿è‡ªUIViewControllerä¸šåŠ¡å­ç±»å‹å«åšBusinessVieweController</p>
<p>è¿˜æ˜¯ç”¨ä¸€å¼ ç®€ç•¥å›¾æ¥è¡¨ç¤ºä¸¤ä¸ªåº“Hookä¹‹åçš„åœºæ™¯å§ï¼š</p>
<p><img src="http://7xqgnx.com1.z0.glb.clouddn.com/RAC%20%E5%92%8C%20AHeater%20%E4%B8%80%E8%B5%B7Hook.png" alt="RACå’ŒAspectsä¸€èµ·Hook"></p>
<p>åœ¨ç±»çš„ç»§æ‰¿ç»“æ„ä¸‹ï¼ŒHookä¹‹åçš„ç»“æœï¼ŒAspectsåœ¨UIViewControllerè¿™ä¸€å±‚ï¼ŒRACåœ¨subClassè¿™ä¸€å±‚å½“æœ‰å¤–ç•Œè°ƒç”¨Aæ–¹æ³•æ—¶ï¼ŒsubClassä¼šæœ€ç»ˆé¦–å…ˆè°ƒç”¨åŸå§‹Aæ–¹æ³•çš„å®ç°ã€‚å¦‚æœè¯´åœ¨BusisnessViewControllerç±»å‹ä¸­å®šä¹‰äº†Aæ–¹æ³•çš„å®ç°ï¼Œå¹¶ä¸”åœ¨Aæ–¹æ³•ä¸­è°ƒç”¨äº†superçš„Aæ–¹æ³•ï¼Œç±»ä¼¼ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidAppear:(BOOL)animated&#10;&#123;&#10;    [super viewDidAppear:animated];&#10;    //&#19994;&#21153;&#20195;&#30721;&#10;    //.....&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£è¿™ä¸ªæ—¶å€™ä¼šç»§ç»­è°ƒç”¨åˆ°UIViewControllerè¿™ä¸€å±‚ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå¼€å§‹èµ°UIViewControllerè¿™ä¸€å±‚çš„Hookæµç¨‹äº†ï¼Œè¿˜æ˜¯ä¸€æ ·æœ€ç»ˆä¼šè°ƒç”¨åˆ°forwardInvocationè¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™subClasså·²ç»å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥è°ƒç”¨æµç¨‹ä¼šå›åˆ°å­ç±»subClassçš„Hookæµç¨‹ä¸­ï¼Œè§ä¸Šå›¾ä¸­å³ä¸Šè§’çš„çº¢è‰²è™šçº¿éƒ¨åˆ†ã€‚åé¢çš„é€»è¾‘å°±æ˜¯æ— é™å¾ªç¯ï¼Œåœ¨ä¸¤ä¸ªç±»å¯¹è±¡ä¸­å¾€è¿”ç›´åˆ°æ ˆæº¢å‡ºã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œå¦‚æœè¯´åœ¨BusinessViewControllerä¸­æ²¡æœ‰è°ƒç”¨superçš„æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ä¼šå¼•èµ·æ­»å¾ªç¯çš„ï¼Œå› ä¸ºä¸ä¼šè§¦å‘UIViewControllerç±»å¯¹è±¡çš„Hookæµç¨‹ã€‚å¹¶ä¸”å½“è§¦å‘äº†æ­»å¾ªç¯ä¹‹åï¼Œä¼šå‘ç°RACè®¢é˜…çš„ä¸šåŠ¡å±‚çš„å›è°ƒå’ŒBusinessViewControllerçš„Aæ–¹æ³•ä¸­é™¤äº†Superé‚£ä¸€å¥ï¼Œå‰©ä¸‹çš„ä¸šåŠ¡ä»£ç ä¹Ÿæ²¡æœ‰è¢«æ‰§è¡Œã€‚å¦å¤–ï¼ŒRACè¿™ç§Hookç›¸å¯¹æ¥è¯´ä¼šæ›´å®‰å…¨ä¸€äº›(å¹¶ä¸æ˜¯è¯´Aspectså°±æ²¡æœ‰Hook Class çš„æƒ…å†µï¼Œåªæ˜¯å½“å‰æ˜¯è¿™æ ·)ï¼šå®ƒå®Œå…¨å­ç±»åŒ–äº†ä¸šåŠ¡ç±»ï¼Œå¹¶ä¸”å°†Hookå…¨éƒ½ä¿ç•™åœ¨äº†æ–°å»ºçš„å­ç±»å‹ä¸­ï¼Œå¯¹å…¶ä»–ç±»å‹åŒ…æ‹¬åŸå§‹ä¸šåŠ¡ç±»å‹æ²¡æœ‰å¹²æ‰°å¹¶ä¸”è¿™ç§Hookåªé’ˆå¯¹äº†æŸä¸ªå…·ä½“çš„å®ä¾‹å¯¹è±¡ï¼Œå…¶ä»–åŠ¿åŠ›å¯¹è±¡å¦‚æœæ²¡æœ‰é€šè¿‡è°ƒç”¨rac_singalForSelectorå¹¶ä¸ä¼šå—åˆ°ä»»ä½•å½±å“ã€‚</p>
<p>å¦‚æœæ˜¯ç›´æ¥HookåŸå§‹ç±»å‹ï¼Œé‚£ä¹ˆå½±å“çš„é¢å°†æ˜¯éå¸¸å¹¿çš„ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„å®ä¾‹å¯¹è±¡å’Œæ‰€æœ‰çš„å­ç±»å¯¹è±¡ã€‚</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/éƒ‘æ™ºæ–‡/">éƒ‘æ™ºæ–‡</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-GitHook" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/25/GitHook/" class="article-date">
  	<time datetime="2017-07-24T16:00:00.000Z" itemprop="datePublished">2017-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/25/GitHook/">Git Hook</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>git hook é€šè¿‡åœ¨ä»£ç commitå’Œpushä¹‹å‰æ‰§è¡Œä¸€ä¸ªè„šæœ¬ï¼Œæ¥å®ç°ä¸€äº›æ£€æŸ¥æ€§å·¥ä½œğŸ˜ã€‚</p>
<p>åœ¨.git/hooksç›®å½•ä¸‹çš„è„šæœ¬æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥ç›®å½•ä¸‹æœ‰ä»¥ä¸‹æ–‡ä»¶</p>
<p>applypatch-msg.sample </p>
<p>commit-msg:sample</p>
<p>pre-applypatch.sample</p>
<p>pre-commit.sample</p>
<p>pre-push.sample</p>
<p>pre-rebase.sample</p>
<p>prepare-commit-msg.sample</p>
<hr>
<p>update.sample</p>
<p>pre-receive.sample</p>
<p>post-update:sample</p>
<p>åˆ†å‰²çº¿å‰é¢å‡ ç§æ˜¯å®¢æˆ·ç«¯é’©å­ï¼Œåé¢å‡ ç§æ˜¯æœåŠ¡ç«¯é’©å­</p>
<p>pre-receiveå¯ä»¥ç”¨æ¥åœ¨æœåŠ¡ç«¯è®¾ç½®ä¸€äº›ä»£ç æ£€æŸ¥çš„åŠŸèƒ½ï¼Œé€šè¿‡å®ƒå¯ä»¥æ‹’ç»ä¸€äº›ä¸æ»¡è¶³æ¡ä»¶çš„pushï¼Œæ— æƒ…çš„æ¨è¡Œä»£</p>
<p>ç æ£€æŸ¥ã€‚</p>
<p>post-receiveå®ƒå‘ç”Ÿåœ¨pushä»£ç ä¹‹åï¼Œå¯ä»¥é€šè¿‡CIæ¥è§¦å‘ä¸€äº›æµ‹è¯•ä»£ç ã€‚</p>
<p>è‹¥è¦ç›¸åº”çš„é’©å­ç”Ÿæ•ˆï¼Œç¼–è¾‘è„šæœ¬æ–‡ä»¶çš„å†…å®¹ï¼Œå»æ‰.sampleåç¼€å³å¯ã€‚è„šæœ¬è‹¥è¿”å›é0å€¼ï¼Œåˆ™ç›¸åº”çš„gitæ“ä½œä¸å†</p>
<p>å¾€åæ‰§è¡Œã€‚</p>
<p>é€šè¿‡pre-pushæ¥ä¸¾ä¸ªğŸŒ°</p>
<p>ç°åœ¨æˆ‘æƒ³åœ¨æ¯æ¬¡pushæ–‡ä»¶ä¹‹æ—¶ï¼Œæ£€æŸ¥é¡¹ç›®ä¸­æœ‰æ²¡æœ‰é‡å¤å›¾ç‰‡ï¼Œæ¥å‡å°‘ä¸å¿…è¦çš„åŒ…ä½“ç§¯ã€‚å‡è®¾æ£€æŸ¥é‡å¤å›¾ç‰‡çš„</p>
<p>è„šæœ¬å«åšduplicate_image_detector.py</p>
<p>ç°åœ¨é€šè¿‡å®¢æˆ·ç«¯é’©å­æ¥å®ç°ï¼Œå› ä¸º./.git/hooksä¸‹çš„æ–‡ä»¶æ˜¯æ— æ³•é€šè¿‡gitæ¥è¿›è¡Œç®¡ç†ï¼Œæ‰€ä»¥åªèƒ½åœ¨å®¢æˆ·ç«¯è‡ªå·±å°†</p>
<p>hookè„šæœ¬æ‹·è´åœ¨./.git/hoosç›®å½•ä¸‹äº†ï¼Œhookè„šæœ¬æœ¬èº«å¯ä»¥é€šè¿‡gitæ¥ç®¡ç†ã€‚</p>
<p>hookè„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash&#10;# &#22270;&#29255;&#26816;&#27979;&#10;if [ ! -f &#34;./Checkers/duplicate_image_detector.py&#34; ]; then&#10;  echo &#34;&#26410;&#38598;&#25104;&#22270;&#29255;&#26816;&#27979;&#33050;&#26412;&#34;&#10;  exit 1&#10;fi</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰å¤šä¸ªä»»åŠ¡éœ€è¦å¤„ç†ï¼Œä¸‹ä¸€ä¸ªä»»åŠ¡éœ€è¦åœ¨ä¸Šä¸€ä¸ªä»»åŠ¡æˆåŠŸä¹‹åå†æ‰§è¡Œï¼Œåˆ™éœ€è¦é€šè¿‡ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$? -eq 0</span><br></pre></td></tr></table></figure>
<p>æ¡ä»¶æ¥åˆ¤æ–­ä¸Šä¸ªä»»åŠ¡æ˜¯å¦ä»¥0ç»“æŸï¼Œä»¥0ç»“æŸè¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼Œåä¹‹è¿”å›é0å°±ä»£è¡¨ä»»åŠ¡ç»“æŸï¼Œä¸å†ç»§ç»­æ‰§è¡Œäº†ï¼Œ<br>æ•´ä½“ç±»ä¼¼ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#21069;&#32622;&#20219;&#21153;&#10;#./abc/xyz/xx.rb&#10;&#10;if [ $? -eq 0 ]; then&#10;&#9;echo &#34;***********xx.rb&#26816;&#27979;&#33050;&#26412;&#36890;&#36807;****************&#34;&#10;else&#10;&#9;echo &#34;***********xx.rb&#26816;&#27979;&#33050;&#26412;&#26410;&#36890;&#36807;****************&#34;&#10;&#9;exit 1&#10;fi&#10;&#10;# &#22270;&#29255;&#26816;&#27979;&#10;if [ ! -f &#34;./Checkers/duplicate_image_detector.py&#34; ]; then&#10;  echo &#34;&#26410;&#38598;&#25104;&#22270;&#29255;&#26816;&#27979;&#33050;&#26412;&#34;&#10;  exit 1&#10;fi</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸ºäº†è¿›ä¸€æ­¥æ–¹ä¾¿ï¼Œå†å†™ä¸€ä¸ªè„šæœ¬æ¥æ£€æŸ¥å½“å‰ç¯å¢ƒæ˜¯å¦å‡†å¤‡å¥½äº†hookè„šæœ¬ï¼Œå¹¶è¿›è¡Œæœ¬åœ°éƒ¨ç½²ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash&#10;&#10;if ![-f ./shell/pre-push]; then&#10;&#9;echo &#34;&#27809;&#26377;&#25214;&#21040;hook&#30340;&#33050;&#26412;&#25991;&#20214;&#34;&#10;&#9;exit(1)&#10;fi&#10;&#10;if [-f ./.git/hooks/pre-push.sample]; then&#10;&#9;rm ./.git/hooks/pre-push.sample&#10;fi&#10;&#10;cp  ./shell/pre-push ./.git/hooks/pre-push&#10;&#10;echo &#34;hook&#35774;&#32622;&#25104;&#21151;&#34;</span><br></pre></td></tr></table></figure>
<p>æ¯æ¬¡æœ‰æ–°äººå°±è®©ä»–æ‰‹åŠ¨è°ƒç”¨ä¸€ä¸‹è¿™ä¸ªè„šæœ¬ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯å¸Œæœ›èƒ½å¤Ÿå°†.git/hooks/ä¸‹çš„è„šæœ¬çº³å…¥gitç®¡ç†ã€‚æš‚æ—¶æ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ¡ˆğŸ˜«ï¼Œæˆ–è€…éƒ¨ç½²åœ¨æœåŠ¡ç«¯ï¼Œä½†æ˜¯éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚</p>
<p>é’ˆå¯¹äºä¸Šè¿°é—®é¢˜ï¼Œæœ€ååœ¨åŒäº‹æç¤ºä¸‹æ‰¾åˆ°ä¸€ä¸ªæ›¿æ¢çš„æ–¹æ¡ˆã€‚åœ¨Xcodeçš„Build Phasesä¸­æ·»åŠ ä¸€ä¸ªâ€Run Scriptâ€åŠŸèƒ½ï¼Œåœ¨Xcodeæ¯æ¬¡ç¼–è¯‘çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚</p>
<p>é¦–å…ˆsetupHook.shéœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash&#10;&#10;if [ -f ./shell/pre-push ]; then&#10;&#9;echo &#34;hook&#25991;&#20214;&#23384;&#22312;&#34;&#10;else&#10;&#9;echo &#34;hook&#25991;&#20214;&#19981;&#23384;&#22312;&#34;&#10;&#9;exit 1&#10;fi&#10;&#10;if [ -f ./.git/hooks/pre-push.sample ]; then&#10;&#9;rm ./.git/hooks/pre-push.sample&#10;fi&#10;&#10;if [ -f ./.git/hooks/pre-push ]; then&#10;&#9;echo &#34;hook&#24050;&#32463;&#35774;&#32622;&#36807;&#34;&#10;else&#10;&#9;echo &#34;hook&#26410;&#35774;&#32622;&#65292;&#24320;&#22987;&#35774;&#32622;&#34;&#10;&#9;cp  ./shell/pre-push ./.git/hooks/pre-push&#10;&#9;echo &#34;hook&#35774;&#32622;&#25104;&#21151;&#34;&#10;fi</span><br></pre></td></tr></table></figure>
<p>ç„¶åå†å°†setupHook.shè„šæœ¬æ·»åŠ è¿›å»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://7xqgnx.com1.z0.glb.clouddn.com/Run%20Script.png" alt="Run Script"></p>
<p>è¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹è„šæœ¬æ‰§è¡Œæƒé™ï¼Œåœ¨cmdä¸­æ‰§è¡Œï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u+x setupHook.sh</span><br></pre></td></tr></table></figure>
<p>å†Buildä¸€ä¸‹ï¼Œæœ€åä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<p><img src="http://7xqgnx.com1.z0.glb.clouddn.com/log.png" alt="log"></p>
<p>å°±è¯´æ˜è®¾ç½®ç”Ÿæ•ˆäº†ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œå°±ä¸ç”¨å¤ªæ‹…å¿ƒæŸä¸ªåŒå­¦å› ä¸ºå¿˜è®°è®¾ç½®hookè„šæœ¬è€Œæäº¤ä»£ç æ²¡æœ‰è§¦å‘è„šæœ¬çš„é—®é¢˜äº†ï¼Œå› ä¸ºæäº¤ä»£ç ä¹‹å‰ä¸å¤ªå¯èƒ½ä¸ä¼šBuildä»£ç ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦åœ¨READMEä¸­æ˜¾ç¤ºçš„æé†’ä¸€ä¸‹ï¼Œæœ€åä¸€æ­¥åªæ˜¯ä»¥é˜²ä¸‡ä¸€ã€‚</p>
<h2 id="u53C2_u8003"><a href="#u53C2_u8003" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90" target="_blank" rel="external">https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90</a></li>
<li><a href="http://www.cnblogs.com/MyEyes/archive/2012/01/12/2320529.html" target="_blank" rel="external">http://www.cnblogs.com/MyEyes/archive/2012/01/12/2320529.html</a></li>
<li><a href="http://www.runoob.com/linux/linux-shell-variable.html" target="_blank" rel="external">http://www.runoob.com/linux/linux-shell-variable.html</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/éƒ‘æ™ºæ–‡/">éƒ‘æ™ºæ–‡</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Method Swizzleä¸­çš„å¯¹è±¡æ¨¡å‹" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/21/Method Swizzleä¸­çš„å¯¹è±¡æ¨¡å‹/" class="article-date">
  	<time datetime="2017-07-21T08:33:46.000Z" itemprop="datePublished">2017-07-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/21/Method Swizzleä¸­çš„å¯¹è±¡æ¨¡å‹/">Method Swizzleä¸­çš„å¯¹è±¡æ¨¡å‹</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>é€šå¸¸é€šè¿‡method swizzleå¯ä»¥äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°(ä¸é™äºåŒä¸€ä¸ªç±»å‹)ï¼Œå…ˆçœ‹ä¸€æ®µä»£ç ï¼š</p>
<p>Peopleç±»</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)talk&#10;&#123;&#10;    NSLog(@&#34;%@&#34;, self.class);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>Studentç±»ç»§æ‰¿People</p>
<p>Student</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (void)load&#10;&#123;&#10;    static dispatch_once_t onceToken;&#10; &#10;    dispatch_once(&#38;onceToken, ^&#123;&#10; &#10;        SEL originalSelector = NSSelectorFromString(@&#34;talk&#34;);&#10; &#10;        SEL swizzleSelector = NSSelectorFromString(@&#34;swizzle_talk&#34;);&#10; &#10;        Method originalMethod = class_getInstanceMethod(self.class, originalSelector);&#10;        Method swizzleMethod = class_getInstanceMethod(self.class,&#10;         swizzleSelector);&#10;        method_exchangeImplementations(originalMethod, swizzleMethod);&#10;    &#125;);&#10;&#125;&#10; &#10;- (void)swizzle_talk&#10;&#123;&#10;    NSLog(@&#34;swizzle_talk: %@&#34;, self.class);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>Methodåœ¨objc-private.hä¸­æœ‰å¦‚ä¸‹å®šä¹‰:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef struct old_method *Method;</span><br></pre></td></tr></table></figure>
<p>old_methodæ˜¯ç»“æ„ä½“ï¼Œå®ƒå®šä¹‰åœ¨objc-runtime-old.hä¸­ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">struct old_method &#123;&#10;    SEL method_name;&#10;    char *method_types;&#10;    IMP method_imp;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>Methodä¸­åŒ…å«äº†3ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å‡½æ•°åï¼Œé€šå¸¸å¯ä»¥é€šè¿‡@selector()è·å–ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯å‡½æ•°å£°æ˜, ç¬¬ä¸‰éƒ¨åˆ†æ˜¯å‡½æ•°å®ç°ï¼Œç†è§£æˆå‡½æ•°æŒ‡é’ˆã€‚</p>
<p>class_getInstanceMethodæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯classï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯selectorã€‚è¿™ä¸ªå‡½æ•°æ˜¯ä»¥classå¼€å¤´çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿæ˜¯ä¼ çš„classå¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ç†è§£ä¸ºä»æ‰€ä¼ é€’çš„ç±»å¯¹è±¡ä¸­æŸ¥æ‰¾æŒ‡å®šçš„æ•°æ®ï¼Œç±»å¯¹è±¡å¯ä»¥é€šè¿‡å®ä¾‹å¯¹è±¡çš„classæ–¹æ³•æ´»çš„ï¼Œç±»å¯¹è±¡å…¨å±€åªæœ‰ä¸€ä¸ªã€‚</p>
<p>Classå¯¹è±¡çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef struct objc_class *Class;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´Classå¯¹è±¡å…¶å®æ˜¯objc_classç»“æ„ä½“ï¼Œå¹³æ—¶ä½¿ç”¨çš„self.classå¾—åˆ°çš„æ˜¯ä¸€ä¸ªobjc_classçš„ç»“æ„ä½“æŒ‡é’ˆã€‚</p>
<p>objc_classå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">struct objc_class : objc_object &#123;&#10; &#10;    Class superclass;&#10; &#10;    const char *name;&#10; &#10;    uint32_t version;&#10; &#10;    uint32_t info;&#10; &#10;    uint32_t instance_size;&#10; &#10;    struct old_ivar_list *ivars;&#10; &#10;    struct old_method_list **methodLists;&#10; &#10;    Cache cache;&#10; &#10;    struct old_protocol_list *protocols;&#10; &#10;    // CLS_EXT only&#10; &#10;    const uint8_t *ivar_layout;&#10; &#10;    struct old_class_ext *ext;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåªåˆ—å‡ºäº†å­—æ®µï¼Œå‡½æ•°å¹¶æ²¡æœ‰åˆ—å‡ºã€‚å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç±»å¯¹è±¡é‡Œé¢åŒ…å«äº†ä»¥ä¸‹æ¯”è¾ƒé‡è¦çš„ä¿¡æ¯ï¼š</p>
<p>1.å®ƒçš„åŸºç±»å¯¹è±¡å­—æ®µsuperclass</p>
<p>2.å®ƒçš„å®ä¾‹å¯¹è±¡æœ‰å“ªäº›å­—æ®µ ivars</p>
<p>3.å®ƒçš„å®ä¾‹å¯¹è±¡æœ‰å“ªäº›æ–¹æ³•ï¼Œå­˜å‚¨åœ¨æ–¹æ³•åˆ—è¡¨ä¸­ **methodLists, è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œå°±æ˜¯å®ƒå¯èƒ½åŒ…å«å¤šä¸ªæ–¹æ³•åˆ—è¡¨ã€‚</p>
<p>4.å®ƒå±äºä»€ä¹ˆç±»å‹çš„ç±»å¯¹è±¡ï¼šinfoï¼Œæ¯”å¦‚CLS_CLASSè¿˜æ˜¯CLS_METAï¼Œç›¸å½“äºç±»å¯¹è±¡è‡ªå·±çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚é€šè¿‡å®ƒå¯ä»¥åˆ¤æ–­å‡ºä¸€ä¸ªç±»å¯¹è±¡æ˜¯å¦æ˜¯å…ƒç±»å¯¹è±¡ã€‚</p>
<p>ä»¥ä¸‹æ˜¯class_getInstanceMethodçš„æºç ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Method class_getInstanceMethod(Class cls, SEL sel)&#10; &#10;&#123;&#10; &#10;    if (!cls  ||  !sel) return nil;&#10; &#10; &#10; &#10; &#10;    // This deliberately avoids +initialize because it historically did so.&#10; &#10; &#10; &#10; &#10;    // This implementation is a bit weird because it&#39;s the only place that&#10; &#10;    // wants a Method instead of an IMP.&#10; &#10; &#10; &#10; &#10;    Method meth;&#10; &#10;    meth = _cache_getMethod(cls, sel, _objc_msgForward_impcache);&#10; &#10;    if (meth == (Method)1) &#123;&#10; &#10;        // Cache contains forward:: . Stop searching.&#10; &#10;        return nil;&#10; &#10;    &#125; else if (meth) &#123;&#10; &#10;        return meth;&#10; &#10;    &#125;&#10; &#10;         &#10; &#10;    // Search method lists, try method resolver, etc.&#10; &#10;    lookUpImpOrNil(cls, sel, nil,&#10; &#10;                   NO/*initialize*/, NO/*cache*/, YES/*resolver*/);&#10; &#10; &#10; &#10; &#10;    meth = _cache_getMethod(cls, sel, _objc_msgForward_impcache);&#10; &#10;    if (meth == (Method)1) &#123;&#10; &#10;        // Cache contains forward:: . Stop searching.&#10; &#10;        return nil;&#10; &#10;    &#125; else if (meth) &#123;&#10; &#10;        return meth;&#10; &#10;    &#125;&#10; &#10; &#10; &#10; &#10;    return _class_getMethod(cls, sel);&#10; &#10;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯å…ˆä»æ–¹æ³•ç¼“å­˜é‡Œå–æ–¹æ³•ï¼Œä¸»è¦çœ‹ä¸‹_class_getMethod</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static Method _class_getMethod(Class cls, SEL sel)&#10;&#123;&#10;    mutex_locker_t lock(methodListLock);&#10; &#10;    return (Method)_getMethod(cls, sel);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨_class_getMethodä¸­è°ƒç”¨äº†_getMethodå‡½æ•°ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static inline old_method * _getMethod(Class cls, SEL sel) &#123;&#10; &#10;    for (; cls; cls = cls-&#62;superclass) &#123;&#10; &#10;        old_method *m;&#10; &#10;        m = _findMethodInClass(cls, sel);&#10; &#10;        if (m) return m;&#10; &#10;    &#125;&#10; &#10;    return nil;&#10; &#10;&#125;</span><br></pre></td></tr></table></figure>
<p>_getMethodæ˜¯ä¸»è¦çš„å®ç°äº†ï¼Œè¿™é‡Œé€šè¿‡_findMethodInClasså‡½æ•°æ¥æŸ¥æ‰¾ç±»å¯¹è±¡çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¾¿åˆ©äº†çˆ¶ç±»å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸºç±»ä¸­çš„æ–¹æ³•ä¹Ÿä¼šè¢«éå†åˆ°ã€‚</p>
<p>ç»§ç»­å†çœ‹ä¸‹_findMethodInClasså‡½æ•°çš„ä»£ç ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static inline old_method * _findMethodInClass(Class cls, SEL sel) &#123;&#10; &#10;    // Flattened version of nextMethodList(). The optimizer doesn&#39;t&#10; &#10;    // do a good job with hoisting the conditionals out of the loop.&#10; &#10;    // Conceptually, this looks like:&#10; &#10;    // while ((mlist = nextMethodList(cls, &#38;iterator))) &#123;&#10; &#10;    //     old_method *m = _findMethodInList(mlist, sel);&#10; &#10;    //     if (m) return m;&#10; &#10;    // &#125;&#10; &#10; &#10; &#10; &#10;    if (!cls-&#62;methodLists) &#123;&#10; &#10;        // No method lists.&#10; &#10;        return nil;&#10; &#10;    &#125;&#10; &#10;    else if (cls-&#62;info &#38; CLS_NO_METHOD_ARRAY) &#123;&#10; &#10;        // One method list.&#10; &#10;        old_method_list **mlistp;&#10; &#10;        mlistp = (old_method_list **)&#38;cls-&#62;methodLists;&#10; &#10;        *mlistp = fixupSelectorsInMethodList(cls, *mlistp);&#10; &#10;        return _findMethodInList(*mlistp, sel);&#10; &#10;    &#125;&#10; &#10;    else &#123;&#10; &#10;        // Multiple method lists.&#10; &#10;        old_method_list **mlistp;&#10; &#10;        for (mlistp = cls-&#62;methodLists;&#10; &#10;             *mlistp != nil  &#38;&#38;  *mlistp != END_OF_METHODS_LIST;&#10; &#10;             mlistp++)&#10; &#10;        &#123;&#10; &#10;            old_method *m;&#10; &#10;            *mlistp = fixupSelectorsInMethodList(cls, *mlistp);&#10; &#10;            m = _findMethodInList(*mlistp, sel);&#10; &#10;            if (m) return m;&#10; &#10;        &#125;&#10; &#10;        return nil;&#10; &#10;    &#125;&#10; &#10;&#125;&#10;  &#10;static inline old_method *_findMethodInList(old_method_list * mlist, SEL sel) &#123;&#10; &#10;    int i;&#10; &#10;    if (!mlist) return nil;&#10; &#10;    for (i = 0; i &#60; mlist-&#62;method_count; i++) &#123;&#10; &#10;        old_method *m = &#38;mlist-&#62;method_list[i];&#10; &#10;        if (m-&#62;method_name == sel) &#123;&#10; &#10;            return m;&#10; &#10;        &#125;&#10; &#10;    &#125;&#10; &#10;    return nil;&#10; &#10;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯é€šè¿‡éå†ç±»å¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨å­—æ®µï¼Œæ¥æŸ¥æ‰¾æŸä¸ªæ–¹æ³•ã€‚</p>
<p>åœ¨_findMethodInListå‡½æ•°ä¸­ï¼Œå®ƒå…¶å®æ˜¯æ¯”è¾ƒäº†æ–¹æ³•åˆ—è¡¨ä¸­æ–¹æ³•çš„Selectorå’Œè¦æ‰¾çš„Selectoræ˜¯ä¸æ˜¯åŒä¸€ä¸ªæ¥æŸ¥æ‰¾è¿™ä¸ªæ–¹æ³•ã€‚æ‰€ä»¥é€šè¿‡selectorå°±å¯ä»¥å®šä½åˆ°ä¸€ä¸ªmethodï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¾—åˆ°å®ƒçš„IMPå’ŒTypeäº†ã€‚</p>
<p>æ‰€ä»¥å¯ä»¥å¾ˆå¥½ç†è§£ä¸€ä¸‹2ä¸ªæ–¹æ³•ï¼š</p>
<p>method_getTypeEncoding</p>
<p>method_getImplementation</p>
<p>é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œå¯ä»¥çŸ¥é“class_getInstanceMethodæ˜¯è·å¾—æŸä¸ªç±»å¯¹è±¡ä¸­çš„æ–¹æ³•å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šéå†åˆ°çˆ¶ç±»ä¸­ã€‚ä¹Ÿå°±æ˜¯å½“å‰ç±»æ²¡æœ‰å®ç°çš„æ–¹æ³•ï¼Œçˆ¶ç±»æ¥æŠµï¼Œä¹Ÿç¬¦åˆé¢å‘å¯¹è±¡çš„è®¾è®¡ã€‚</p>
<p>æ€»çš„è¯´æ¥ï¼Œclass_getxxxxxxxæ˜¯é€šè¿‡æŸ¥æ‰¾ç±»å¯¹è±¡å†…éƒ¨æ•°æ®æ¥å¾—åˆ°ä¸€äº›æ¶ˆæ¯ï¼Œç±»ä¼¼çš„è¿˜æœ‰</p>
<p>class_getClassMethodï¼Œå®ƒæ˜¯è·å–ç±»æ–¹æ³•çš„å‡½æ•°ï¼š</p>
<p>çœ‹çœ‹å®ƒçš„æºç ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Method class_getClassMethod(Class cls, SEL sel)&#10;&#123;&#10;    if (!cls  ||  !sel) return nil;&#10;    return class_getInstanceMethod(cls-&#62;getMeta(), sel);&#10;&#125; &#10;  &#10;Class getMeta() &#123;&#10; &#10;   if (isMetaClass()) return (Class)this;&#10; &#10;   else return this-&#62;ISA();&#10;&#125;&#10;  &#10;bool isMetaClass() &#123;&#10;   return info &#38; CLS_META;&#10;&#125;&#10;  &#10;#define CLS_CLASS 0X1&#10;#define CLS_META 0x2</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çŸ¥é“å¦‚æœå½“å‰ç±»å°±æ˜¯å…ƒç±»å¯¹è±¡ï¼Œå°±è¿”å›å®ƒè‡ªå·±åä¹‹è¿”å›thisâ†’ISA();</p>
<p>objc_classç»§æ‰¿è‡ªobjc_object,å‡½æ•°ISAæ˜¯objc_objectä¸­å®šä¹‰çš„:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truct objc_object &#123;&#10; &#10;private:&#10; &#10;    isa_t isa; &#10;&#125;&#10;  &#10;uion isa_t &#123;&#10;  &#10;  Class clas;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºå–å‡ºobjc_classå¯¹è±¡çš„clsä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å…ƒç±»å¯¹è±¡äº†ã€‚</p>
<p>ç„¶åé€šè¿‡cls_getInstanceMethodæ¥å»åˆ°Methodä¿¡æ¯ï¼Œè·Ÿä¹‹å‰å–ç±»å¯¹è±¡ä¸­çš„Methodä¸€æ ·ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥å–å…ƒç±»å¯¹è±¡çš„æ­¥éª¤ã€‚</p>
<p>åœ¨ç†è§£äº†class_getInstanceMethodå‡½æ•°ä¹‹åï¼Œå†æ¥çœ‹ä¸€ä¸‹class_addMethodå‡½æ•°ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BOOL class_addMethod(Class cls, SEL name, IMP imp, const char *types)&#10; &#10;&#123;&#10; &#10;    IMP old;&#10; &#10;    if (!cls) return NO;&#10; &#10;    old = _class_addMethod(cls, name, imp, types, NO);&#10; &#10;    return !old;&#10; &#10;&#125;&#10;static IMP _class_addMethod(Class cls, SEL name, IMP imp,&#10; &#10;                            const char *types, bool replace)&#10;&#123;&#10; &#10;    old_method *m;&#10; &#10;    IMP result = nil;&#10; &#10; &#10; &#10; &#10;    if (!types) types = &#34;&#34;;&#10; &#10; &#10; &#10; &#10;    mutex_locker_t lock(methodListLock);&#10; &#10; &#10; &#10; &#10;    if ((m = _findMethodInClass(cls, name))) &#123;&#10; &#10;        // already exists&#10; &#10;        // fixme atomic&#10; &#10;        result = method_getImplementation((Method)m);&#10; &#10;        if (replace) &#123;&#10; &#10;            method_setImplementation((Method)m, imp);&#10; &#10;        &#125;&#10; &#10;    &#125; else &#123;&#10; &#10;        // fixme could be faster&#10; &#10;        old_method_list *mlist =&#10; &#10;            (old_method_list *)calloc(sizeof(old_method_list), 1);&#10; &#10;        mlist-&#62;obsolete = fixed_up_method_list;&#10; &#10;        mlist-&#62;method_count = 1;&#10; &#10;        mlist-&#62;method_list[0].method_name = name;&#10; &#10;        mlist-&#62;method_list[0].method_types = strdup(types);&#10; &#10;        mlist-&#62;method_list[0].method_imp = imp;&#10; &#10;         &#10; &#10;        _objc_insertMethods(cls, mlist, nil);&#10; &#10;        if (!(cls-&#62;info &#38; CLS_CONSTRUCTING)) &#123;&#10; &#10;            flush_caches(cls, NO);&#10; &#10;        &#125; else &#123;&#10; &#10;            // in-construction class has no subclasses&#10; &#10;            flush_cache(cls);&#10; &#10;        &#125;&#10; &#10;        result = nil;&#10; &#10;    &#125;&#10; &#10;    return result;&#10; &#10;&#125;</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºå½“å‰ç±»å¯¹è±¡ä¸­å­˜åœ¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™(åŒ…æ‹¬çˆ¶ç±»çš„)ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå¤„ç†è¿”å›NOã€‚å¦‚æœä¸å­˜åœ¨é‚£ä¹ˆä¼šæ·»åŠ ä¸€ä¸ª,å¹¶ä¸”è¿”å›YESã€‚</p>
<p>æ¥ç€æ˜¯class_replaceMethod</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IMP class_replaceMethod(Class cls, SEL name, IMP imp, const char *types)&#10;&#123;&#10;    if (!cls) return nil;&#10;    return _class_addMethod(cls, name, imp, types, YES);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•å’Œclass_addMethodçš„åŒºåˆ«æ˜¯ï¼Œå¦‚æœå‘ç°å·²ç»å­˜åœ¨selå¯¹åº”çš„Methodï¼Œå‰è€…ä¼šç›´æ¥é€šè¿‡æ–°çš„impè¦†ç›–åŸæ¥çš„methodï¼Œåè€…åˆ™ä¸ä¼šåšä»»ä½•å¤„ç†ã€‚</p>
<p>æœ€åmethod_exchangeImplementationsäº¤æ¢ä¸¤ä¸ªmethodçš„å®ç°ã€‚</p>
<p>ç°åœ¨åˆ†æä¸€ä¸‹æ–‡ç« å¼€å¤´é‚£æ®µä»£ç ï¼Œå½“å½“å‰ç±»æœ¬èº«æ²¡æœ‰å®ç°original_selectoræ–¹æ³•çš„æ—¶å€™ï¼Œä½†æ˜¯å®ƒçš„åŸºç±»å®ç°äº†ã€‚é‚£ä¹ˆæœ€åäº¤æ¢çš„å°±æ˜¯åŸºç±»ä¸­çš„original_selectoræ–¹æ³•ï¼Œè¿™å°†ä¼šå½±å“åŸºç±»å’Œå…¶ä»–ç»§æ‰¿å­ç±»çš„è¡Œä¸ºã€‚ç°åœ¨é€šè¿‡ä¸€ä¸ªç®€å•çš„demoæ¥éªŒè¯ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@interface People : NSObject&#10; &#10;- (void)talk;&#10; &#10;@end&#10;@implementation People&#10; &#10;- (void)talk&#10; &#10;&#123;&#10; &#10;    NSLog(@&#34;%@&#34;, self.class);&#10; &#10;&#125;&#10; &#10; &#10;  &#10;  &#10;@interface Student : People&#10;  &#10;@end&#10;  &#10;@implemention Student&#10;  &#10;@end&#10;  &#10;  &#10;  &#10;@interface Teacher : People&#10; &#10;@end&#10; &#10; &#10;@implemention Teacher&#10; &#10;@end&#10;@interface Student (Tracking)&#10; &#10;@end&#10; &#10; &#10;@implemention Student&#10; &#10;+ (void)load&#10; &#10;&#123;&#10; &#10;    static dispatch_once_t onceToken;&#10; &#10;    dispatch_once(&#38;onceToken, ^&#123;&#10; &#10;        SEL originalSelector = NSSelectorFromString(@&#34;talk&#34;);&#10; &#10;        SEL swizzleSelector = NSSelectorFromString(@&#34;swizzle_talk&#34;);&#10; &#10;        Method originalMethod = class_getInstanceMethod(self.class, &#10;            originalSelector);&#10; &#10;        Method swizzleMethod = class_getInstanceMethod(self.class, &#10;            swizzleSelector);&#10;         &#10;        method_exchangeImplementations(originalMethod, swizzleMethod);&#10;    &#125;);&#10;&#125;&#10; &#10; &#10; &#10;- (void)swizzle_talk&#10; &#10;&#123;&#10; &#10;    NSLog(@&#34;zwizzle_talk: %@&#34;, self.class);&#10; &#10;&#125;&#10; &#10;@end&#10;  &#10;- (void)viewDidLoad &#123;&#10; &#10;    [super viewDidLoad];&#10; &#10; &#10;    Teacher *t = [[Teacher alloc] init];&#10; &#10;    [t talk];&#10; &#10;    Student *stu = [[Student alloc] init];&#10; &#10;    [stu talk];&#10; &#10;&#125;&#10; &#10;@end</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºæ˜¯ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">20:15:35.432 abc[87901:2148310] zwizzle_talk: Teacher&#10; &#10;20:15:35.433 abc[87901:2148310] zwizzle_talk: Student</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ Teacherç±»ä¹Ÿæ”¶åˆ°äº†student swizzleçš„å½±å“ã€‚</p>
<p>Student(Tracking)æ¢ä¸€ç§å†™æ³•:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (void)load&#10;&#123;&#10;    static dispatch_once_t onceToken;&#10; &#10;    dispatch_once(&#38;onceToken, ^&#123;&#10; &#10;        SEL originalSelector = NSSelectorFromString(@&#34;talk&#34;);&#10; &#10;        SEL swizzleSelector = NSSelectorFromString(@&#34;swizzle_talk&#34;);&#10; &#10;        Method originalMethod = class_getInstanceMethod(self.class, &#10;            originalSelector);&#10; &#10;        Method swizzleMethod = class_getInstanceMethod(self.class, &#10;            swizzleSelector);&#10; &#10;        BOOL addMethod = class_addMethod(self.class, originalSelector, &#10;            method_getImplementation(swizzleMethod), method_getTypeEncoding(&#10;                swizzleMethod));&#10; &#10;        if (addMethod) &#123;&#10;            class_replaceMethod(self.class, swizzleSelector, &#10;                method_getImplementation(originalMethod), &#10;                method_getTypeEncoding(originalMethod));&#10;        &#125; else &#123;&#10;            method_exchangeImplementations(originalMethod, swizzleMethod);&#10;        &#125;&#10;    &#125;);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºæ˜¯ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">20:19:50.683 abc[87966:2152486] Teacher&#10; &#10;20:19:50.684 abc[87966:2152486] zwizzle_talk: Student</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒTeacherç±»å¹¶æ²¡æœ‰æ”¶åˆ°å½±å“ï¼Œè™½ç„¶æ˜¯åŸºç±»ä¸­å®ç°äº†talkæ–¹æ³•ï¼Œä½†æ˜¯é€šè¿‡class_addMethodç»™å½“å‰ç±»StudentåŠ¨æ€å¢åŠ äº†talkçš„å®ç°ï¼Œç„¶åè¿›è¡Œäº¤æ¢ã€‚æ²¡æœ‰å½±å“åˆ°åŸæ¥Peopleç±»ä¸­çš„talkæ–¹æ³•ã€‚</p>
<p>å¯ä»¥çœ‹å‡ºï¼Œç¬¬äºŒç§æ–¹æ³•å®ç°èµ·æ¥æ›´å¥½ï¼Œå½±å“èŒƒå›´æ›´å°ä¸€äº›ã€‚</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/éƒ‘æ™ºæ–‡/">éƒ‘æ™ºæ–‡</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-XcodeDebug" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/21/XcodeDebug/" class="article-date">
  	<time datetime="2017-07-20T16:00:00.000Z" itemprop="datePublished">2017-07-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/21/XcodeDebug/">Xcode Debug Toolset</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Xcode_Debug_Toolset"><a href="#Xcode_Debug_Toolset" class="headerlink" title="Xcode Debug Toolset"></a>Xcode Debug Toolset</h1><h2 id="print"><a href="#print" class="headerlink" title="print"></a>print</h2><ul>
<li>ç®€å†™æˆp, pri, ptin</li>
<li>po(print object)å¯ä»¥æ‰“å°å¯¹è±¡çš„descriptionæ–¹æ³•çš„ç»“æœ</li>
<li>æ‰“å°ä¸åŒæ ¼å¼å¯ä»¥ç”¨p/x numberæ‰“å°åå…­è¿›åˆ¶ï¼Œp/t numberæ‰“å°äºŒè¿›åˆ¶ï¼Œp/c charæ‰“å°å­—ç¬¦ã€‚è¿™é‡Œæ˜¯å®Œæ•´æ¸…å•<a href="https://sourceware.org/gdb/onlinedocs/gdb/Output-Formats.html" target="_blank" rel="external">https://sourceware.org/gdb/onlinedocs/gdb/Output-Formats.html</a></li>
<li><code>po [0x1234 _ivarDescription]</code></li>
<li><code>po [0x1234 _shortMethodDescription]</code></li>
<li><code>po [0x1234 _methodDescription]</code></li>
<li><code>po [[UIWindow keyWindow] recursiveDescription]</code>æ‰“å°windowæ‰€æœ‰çš„è§†å›¾å±‚çº§</li>
<li><code>po [[[UIWindow keyWindow] rootViewController] _printHierarchy]</code>æ‰“å°controllerçš„è§†å›¾å±‚çº§</li>
</ul>
<h5 id="u8C03_u8BD5_u5BC4_u5B58_u5668_u4E2D_u7684_u53D8_u91CF_uFF1A"><a href="#u8C03_u8BD5_u5BC4_u5B58_u5668_u4E2D_u7684_u53D8_u91CF_uFF1A" class="headerlink" title="è°ƒè¯•å¯„å­˜å™¨ä¸­çš„å˜é‡ï¼š"></a>è°ƒè¯•å¯„å­˜å™¨ä¸­çš„å˜é‡ï¼š</h5><ul>
<li><code>register read</code> æ‰“å°å¯„å­˜å™¨ä¸­çš„å€¼</li>
</ul>
<table>
<thead>
<tr>
<th>platform</th>
<th>recriver</th>
<th>SEL</th>
<th>Arg1</th>
<th>Arg2</th>
<th>return value</th>
</tr>
</thead>
<tbody>
<tr>
<td>x86_64</td>
<td>rdiæˆ–è€…<code>$rbp+16</code></td>
<td>rsiæˆ–è€…<code>$rbp+24</code></td>
<td>rdxæˆ–è€…<code>$rbp+32</code></td>
<td>rcxæˆ–è€…<code>$rbp+40</code></td>
<td>rax</td>
</tr>
<tr>
<td>arm64</td>
<td>x0</td>
<td>x1</td>
<td>x2</td>
<td>x3</td>
</tr>
<tr>
<td>arm</td>
<td>r0</td>
<td>r1</td>
<td>r2</td>
<td>r3</td>
</tr>
</tbody>
</table>
<h2 id="erpression"><a href="#erpression" class="headerlink" title="erpression"></a>erpression</h2><ul>
<li>ç®€å†™æˆ eï¼Œæ‰§è¡Œä»£ç </li>
<li><code>e [((UIView *)0x06ae2) setBackgroundColor:[UIColor redColor]]</code>æ›´æ”¹ä¸€ä¸ªviewçš„èƒŒæ™¯é¢œè‰²</li>
<li><code>e class_getInstanceMethod([MyViewController class], @selector(layoutSubviews))</code>æŸ¥çœ‹Method</li>
<li><code>e BOOL $a = YES</code>åˆ›å»ºä¸€ä¸ªå˜é‡ï¼Œå˜é‡åè¦ä»¥<code>$</code>ä½œå‰ç¼€</li>
</ul>
<h2 id="Breakpoint"><a href="#Breakpoint" class="headerlink" title="Breakpoint"></a>Breakpoint</h2><h3 id="u547D_u4EE4_u884C_u6DFB_u52A0_u65AD_u70B9"><a href="#u547D_u4EE4_u884C_u6DFB_u52A0_u65AD_u70B9" class="headerlink" title="å‘½ä»¤è¡Œæ·»åŠ æ–­ç‚¹"></a>å‘½ä»¤è¡Œæ·»åŠ æ–­ç‚¹</h3><ul>
<li><code>br set -a 0x01234</code></li>
<li><code>br set -r &quot;UIView&quot;</code></li>
</ul>
<h3 id="u901A_u7528_u65AD_u70B9"><a href="#u901A_u7528_u65AD_u70B9" class="headerlink" title="é€šç”¨æ–­ç‚¹"></a>é€šç”¨æ–­ç‚¹</h3><ul>
<li>All Exceptions å¼‚å¸¸æ–­ç‚¹</li>
<li><p><code>UIViewAlertForUnsatisfiableConstraints</code> :<br>åœ¨é‡åˆ°Autolayoutçº¦æŸå†²çªæ—¶ä¼šè§¦å‘è¯¥æ–­ç‚¹</p>
</li>
<li><p><code>UIApplicationMain</code>:</p>
<p><strong>Debugger Command:</strong><code>e @import UIKit</code></p>
<p>è¿™æ ·åœ¨æ§åˆ¶å°ä¸­å¯ä»¥ç›´æ¥æ‰“å°viewçš„frame:<br><code>p [view bounds]</code></p>
<p>  <img src="http://chuantu.biz/t5/143/1500545154x1730513932.png" alt=""></p>
</li>
</ul>
<h3 id="u7B26_u53F7_u65AD_u70B9"><a href="#u7B26_u53F7_u65AD_u70B9" class="headerlink" title="ç¬¦å·æ–­ç‚¹"></a>ç¬¦å·æ–­ç‚¹</h3><p> <img src="http://chuantu.biz/t5/143/1500545827x1730513932.png" alt=""></p>
<h3 id="u5C06_u65AD_u70B9_u6DFB_u52A0_u5230User_Breakpoints_u4E2D_uFF0C_u53EF_u4EE5_u8DE8_u5DE5_u7A0B_u5171_u4EAB"><a href="#u5C06_u65AD_u70B9_u6DFB_u52A0_u5230User_Breakpoints_u4E2D_uFF0C_u53EF_u4EE5_u8DE8_u5DE5_u7A0B_u5171_u4EAB" class="headerlink" title="å°†æ–­ç‚¹æ·»åŠ åˆ°User Breakpointsä¸­ï¼Œå¯ä»¥è·¨å·¥ç¨‹å…±äº«"></a>å°†æ–­ç‚¹æ·»åŠ åˆ°User Breakpointsä¸­ï¼Œå¯ä»¥è·¨å·¥ç¨‹å…±äº«</h3><p> <img src="https://pspdfkit.com/images/blog/2017/user-breakpoints-in-xcode/move-to-user@2x-d63238f8.png" alt="s"></p>
<h2 id="watchpoint"><a href="#watchpoint" class="headerlink" title="watchpoint"></a>watchpoint</h2><p>  ç›‘è§†å†…å­˜åœ°å€å‘ç”Ÿè¯»å†™</p>
<ul>
<li><p><code>watchpoint s e read 0x7f8c519b4600</code></p>
</li>
<li><p><code>watchpoint s e read_write 0x7f8c519b4600</code></p>
</li>
</ul>
<p>ç›‘è§†vMainå˜é‡ä»€ä¹ˆæ—¶å€™è¢«é‡å†™äº†ï¼Œç›‘è§†è¿™ä¸ªåœ°å€ä»€ä¹ˆæ—¶å€™è¢«å†™å…¥</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(lldb) p (<span class="keyword">ptrdiff_t</span>)ivar_getOffset((<span class="keyword">struct</span> Ivar *)class_getInstanceVariable([MyView <span class="keyword">class</span>], <span class="string">"vMain"</span>))</span><br><span class="line">(<span class="keyword">ptrdiff_t</span>) $<span class="number">0</span> = <span class="number">8</span></span><br><span class="line">(lldb) watchpoint <span class="built_in">set</span> expression -- (<span class="keyword">int</span> *)$myView + <span class="number">8</span></span><br><span class="line">Watchpoint created: Watchpoint <span class="number">3</span>: addr = <span class="number">0x7fa554231340</span> size = <span class="number">8</span> state = enabled type = w</span><br><span class="line"><span class="keyword">new</span> value: <span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure>
<h2 id="image_lookup"><a href="#image_lookup" class="headerlink" title="image lookup"></a>image lookup</h2><ul>
<li><code>image lookup -s UIView</code> æ‰“å°UIViewæ‰€åœ¨çš„æ˜ åƒæ–‡ä»¶</li>
<li><code>image lookup -n setCenterPlaceholder</code>æ‰“å°æŸä¸ªæ–¹æ³•æ‰€åœ¨çš„æ˜ åƒæ–‡ä»¶</li>
<li>æ›´å¤šç”¨æ³•å‚è€ƒ <code>help image lookup</code></li>
</ul>
<h2 id="xcode__u73AF_u5883_u53D8_u91CF"><a href="#xcode__u73AF_u5883_u53D8_u91CF" class="headerlink" title="xcode ç¯å¢ƒå˜é‡"></a>xcode ç¯å¢ƒå˜é‡</h2><ul>
<li><code>OBJC_PRINT_REPLACED_METHODS YES</code> æ‰“å°é‡åæ–¹æ³•</li>
<li><code>DYLD_PRINT_STATISTICS 1</code> æ‰“å°Appå¯åŠ¨æ—¶DYLDåŠ è½½æ—¶é•¿</li>
</ul>
<h2 id="u53C2_u8003"><a href="#u53C2_u8003" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://developer.apple.com/library/content/technotes/tn2239/_index.html" target="_blank" rel="external">https://developer.apple.com/library/content/technotes/tn2239/_index.html</a></li>
<li><a href="https://www.objc.io/issues/19-debugging/debugging-case-study/" target="_blank" rel="external">https://www.objc.io/issues/19-debugging/debugging-case-study/</a></li>
<li><a href="https://pspdfkit.com/blog/2017/user-breakpoints-in-xcode/" target="_blank" rel="external">https://pspdfkit.com/blog/2017/user-breakpoints-in-xcode/</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/æèˆª/">æèˆª</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-RNä¸­çš„CSSåº”ç”¨" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/24/RNä¸­çš„CSSåº”ç”¨/" class="article-date">
  	<time datetime="2016-02-24T07:07:42.000Z" itemprop="datePublished">2016-02-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/24/RNä¸­çš„CSSåº”ç”¨/">RNä¸­çš„Styleåº”ç”¨</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="RN_u4E2D_u7684Style_u5E94_u7528"><a href="#RN_u4E2D_u7684Style_u5E94_u7528" class="headerlink" title="RNä¸­çš„Styleåº”ç”¨"></a>RNä¸­çš„Styleåº”ç”¨</h1><h2 id="u57FA_u7840_u7406_u8BBA_u7BC7_uFF1A"><a href="#u57FA_u7840_u7406_u8BBA_u7BC7_uFF1A" class="headerlink" title="åŸºç¡€ç†è®ºç¯‡ï¼š"></a>åŸºç¡€ç†è®ºç¯‡ï¼š</h2><h3 id="u8BBE_u5907_u5C3A_u5BF8_u548C_u5206_u8FA8_u7387"><a href="#u8BBE_u5907_u5C3A_u5BF8_u548C_u5206_u8FA8_u7387" class="headerlink" title="è®¾å¤‡å°ºå¯¸å’Œåˆ†è¾¨ç‡"></a>è®¾å¤‡å°ºå¯¸å’Œåˆ†è¾¨ç‡</h3><h4 id="Dimensions"><a href="#Dimensions" class="headerlink" title="Dimensions"></a><a href="https://github.com/facebook/react-native/blob/master/Libraries/Utilities/Dimensions.js" target="_blank" rel="external">Dimensions</a></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * iOS å’Œ android çš„window</span><br><span class="line"> * scaleæ˜¯é€»è¾‘åæ ‡è½¬æ¢æˆç‰©ç†åæ ‡æ—¶ä½¿ç”¨çš„å˜å¹»ç³»æ•°(device pixel density)</span><br><span class="line"> * fontScale (android only)</span><br><span class="line"> * ã€æ³¨ã€‘è‹¥å†™åˆ°styleä¸­, éœ€è¦åœ¨renderæ—¶æ›´æ–°ä¸€æ¬¡</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123;height, width, scale, fontScale&#125; = Dimensions.get(<span class="string">'window'</span>);</span><br><span class="line"><span class="comment">//androidæœ‰ Screen å’Œ windowçš„åŒºåˆ«; iOSæ— </span></span><br><span class="line"><span class="keyword">const</span> &#123;height, width, scale, fontScale&#125; = Dimensions.get(<span class="string">'screen'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‰æ¯”ä¾‹ä½¿ç”¨ size (@mtfe/react-native-css)</span></span><br><span class="line"><span class="keyword">const</span> ratio =  Dimensions.get(<span class="string">'window'</span>).width / <span class="number">320</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">r</span> (<span class="params">size</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.floor(size * ratio);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="PixelRatio"><a href="#PixelRatio" class="headerlink" title="PixelRatio"></a><a href="https://github.com/facebook/react-native/blob/master/Libraries/Utilities/PixelRatio.js" target="_blank" rel="external">PixelRatio</a></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒä¸Š</span></span><br><span class="line"><span class="keyword">const</span> &#123;scale, fontScale&#125; = &#123;scale: PixelRatio.get(), fontScale: PixelRatio.getFontScale()&#125;;</span><br><span class="line"><span class="comment">//æŠŠ point è½¬æˆ pixel,å³: point * scale</span></span><br><span class="line"><span class="keyword">const</span> pixelSize = PixelRatio.getPixelSizeForLayoutSize(pointSize);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸€ä¸ªpixel å¯¹åº”çš„ pointå¤§å°</span></span><br><span class="line"><span class="keyword">const</span> px = <span class="number">1</span>/PixelRatio.get();</span><br></pre></td></tr></table></figure>
<h3 id="FlexBox"><a href="#FlexBox" class="headerlink" title="FlexBox"></a><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/" target="_blank" rel="external">FlexBox</a></h3><p>èƒŒæ™¯ä»‹ç»ï¼šè·Ÿä¼ ç»Ÿçš„Boxæ¨¡å‹å¯¹æ¯”, Flexbox Layoutç›®æ ‡æ˜¯ä¸€ä¸ªcontainerå®ç°æ›´æœ‰æ•ˆçš„å¸ƒå±€ã€å¯¹é½ã€è‡ªåŠ¨å¡«å……, å³ä½¿åœ¨å­å…ƒç´ å¤§å°æˆ–ä¸ªæ•°æ²¡æœ‰æŒ‡å®šçš„æƒ…å†µä¸‹ã€‚ RNçš„flexå¸ƒå±€æ˜¯Webçš„å­é›†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//====================== ä¿®é¥°å­å…ƒç´ åœ¨å½“å‰å…ƒç´ ä¸­çš„å¸ƒå±€ ==========================</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * å­å…ƒç´ çš„æ’åˆ—æ–¹å‘ row: ä»å·¦åˆ°å³æ¨ªå‘æ’ column:ä»ä¸Šåˆ°ä¸‹ç«–å‘æ’</span><br><span class="line"> * å½“å‰å…ƒç´ æœ‰flexDirectå, æ‰èƒ½ä½¿ç”¨flex layout</span><br><span class="line"> */</span></span><br><span class="line">flexDirection 	enum(<span class="string">'row'</span>, <span class="string">'column'</span>)</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * å­å…ƒç´ æ— æ³•åœ¨å•è¡Œ(one line)ä¸­å±•ç¤ºå®Œå…¨, æ˜¯å¦å¤šè¡Œå±•ç¤º</span><br><span class="line"> */</span></span><br><span class="line">flexWrap 		enum(<span class="string">'wrap'</span>, <span class="string">'nowrap'</span>)</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * å­å…ƒç´ åœ¨å½“å‰å…ƒç´ çš„æ¨ªè½´(main axis)å¯¹é½æ–¹å¼ </span><br><span class="line"> * flex-start: 	ä¾æ¬¡æ’åˆ—, å·¦å¯¹é½startline</span><br><span class="line"> * flex-end: 	ä¾æ¬¡æ’åˆ—, å³å¯¹é½endline</span><br><span class="line"> * center:		ä¾æ¬¡æ’æ³„, å±…ä¸­</span><br><span class="line"> * space-betweenå·¦å³å­å…ƒç´ åˆ†åˆ«å¯¹é½startlineå’Œendline, å…ƒç´ é—´çš„spaceç›¸ç­‰, å…ƒç´ å æ»¡çˆ¶å…ƒç´ ç©ºé—´</span><br><span class="line"> * space-around ***</span><br><span class="line"> */</span></span><br><span class="line">justifyContent 	enum(<span class="string">'flex-start'</span>, <span class="string">'flex-end'</span>, <span class="string">'center'</span>, <span class="string">'space-between'</span>, <span class="string">'space-around'</span>)</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * å­å…ƒç´ åœ¨å½“å‰å…ƒç´ çš„çºµè½´(cross axis)å¯¹é½æ–¹å¼ </span><br><span class="line"> * flex-start: 	å­å…ƒç´ çš„ä¸Šsideå¯¹é½å½“å‰å…ƒç´ çºµè½´çš„startline</span><br><span class="line"> * flex-end: 	å­å…ƒç´ çš„ä¸‹sideå¯¹é½å½“å‰å…ƒç´ çºµè½´çš„endline</span><br><span class="line"> * center:		å­å…ƒç´ çš„ä¸­å¿ƒè·Ÿå½“å‰å…ƒç´ çºµè½´çš„ä¸­å¿ƒå¯¹é½</span><br><span class="line"> * strech		æ‹‰ä¼¸å­å…ƒç´ , ä¸Šsideå¯¹é½startline, ä¸‹sideå¯¹é½endline, å³é«˜åº¦è·Ÿå½“å‰å…ƒç´ çºµè½´ç›¸åŒ</span><br><span class="line"> */</span></span><br><span class="line">alignItems 		enum(<span class="string">'flex-start'</span>, <span class="string">'flex-end'</span>, <span class="string">'center'</span>, <span class="string">'stretch'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//====================== ä¿®é¥°å½“å‰å…ƒç´ åœ¨çˆ¶å…ƒç´ ä¸­çš„å¸ƒå±€ ==========================</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * å½“å‰å…ƒç´ åœ¨çˆ¶å…ƒç´ ä¸­çš„flexç©ºé—´å æ¯”, å³ =å½“å‰flexå€¼/åŒçº§æ‰€æœ‰å­å…ƒç´ çš„flexå€¼çš„å’Œ</span><br><span class="line"> * å»ºè®®é»˜è®¤çˆ¶å…ƒç´ flexç©ºé—´ä¸º1, å­å…ƒç´ æ ¹æ®1ç®—å‡ºè‡ªå·±çš„flexæ•°å€¼</span><br><span class="line"> */</span></span><br><span class="line">flex 			number</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * å½“å‰å…ƒç´ å¯ä»¥è‡ªé€‰åœ¨çˆ¶å…ƒç´ çš„çºµè½´(cross axis)å¯¹é½æ–¹å¼ </span><br><span class="line"> * flex-start: 	å½“å‰å…ƒç´ çš„ä¸Šsideå¯¹é½çˆ¶å…ƒç´ çºµè½´çš„startline</span><br><span class="line"> * flex-end: 	å½“å‰å…ƒç´ çš„ä¸‹sideå¯¹é½çˆ¶å…ƒç´ çºµè½´çš„endline</span><br><span class="line"> * center:		å½“å‰å…ƒç´ çš„ä¸­å¿ƒè·Ÿçˆ¶å…ƒç´ çºµè½´çš„ä¸­å¿ƒå¯¹é½</span><br><span class="line"> * strech		æ‹‰ä¼¸å½“å‰å…ƒç´ , ä¸Šsideå¯¹é½startline, ä¸‹sideå¯¹é½endline, å³é«˜åº¦è·Ÿçˆ¶å…ƒç´ çºµè½´ç›¸åŒ</span><br><span class="line"> */</span></span><br><span class="line">alignSelf 		enum(<span class="string">'auto'</span>, <span class="string">'flex-start'</span>, <span class="string">'flex-end'</span>, <span class="string">'center'</span>, <span class="string">'strech'</span>)</span><br></pre></td></tr></table></figure>
<p>============================== å›¾ç¤ºå¦‚ä¸‹ ==========================================</p>
<p><strong>flexDirection</strong></p>
<p><img src="http://7xr71r.com1.z0.glb.clouddn.com/flex-direction.jpg" alt="Alt text"></p>
<p><strong>flexWrap</strong></p>
<p><img src="http://7xr71r.com1.z0.glb.clouddn.com/flex-wrap.jpg" alt="Alt text"></p>
<p><strong>justifyContent</strong></p>
<p><img src="http://7xr71r.com1.z0.glb.clouddn.com/justify-content.jpg" alt="Alt text"></p>
<p><strong>alignItems</strong></p>
<p><img src="http://7xr71r.com1.z0.glb.clouddn.com/align-items.jpg" alt="Alt text"></p>
<p><strong>alignSelf</strong></p>
<p><img src="http://7xr71r.com1.z0.glb.clouddn.com/align-items.jpg" alt="Alt text"></p>
<h3 id="Box_Model"><a href="#Box_Model" class="headerlink" title="Box Model"></a><a href="https://www.w3.org/TR/REC-CSS2/box.html" target="_blank" rel="external">Box Model</a></h3><p><img src="http://7xr71r.com1.z0.glb.clouddn.com/css-box-model.jpg" alt="Alt text"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">topã€rightã€bottomã€left</span><br><span class="line">marginTopã€marginRightã€marginBottomã€marginLeft</span><br><span class="line">marginHorizontalã€marginVertical</span><br><span class="line">paddingTopã€paddingRightã€paddingBottomã€paddingLeft</span><br><span class="line">paddingHorizontalã€paddingVertical</span><br><span class="line">borderTopWidthã€borderRightWidthã€borderBottomWidthã€borderLeftWidth</span><br><span class="line">widthã€height</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * å½“å‰å…ƒç´ åœ¨çˆ¶å…ƒç´ ä¸­çš„å®šä½æ ·å¼, ä½¿ç”¨ topã€rightã€bottomã€left + widthã€height å®ç°å‡†ç¡®å¸ƒå±€</span><br><span class="line"> * absolute: ä»çˆ¶å…ƒç´ çš„æ’åˆ—ä¸­è„±ç¦», ä¸å æ®çˆ¶å…ƒç´ çš„ç©ºé—´, å…¶ä»–å­å…ƒç´ flexæ—¶å¯ä»¥è®¤ä¸ºå½“å‰å…ƒç´ ä¸å­˜åœ¨</span><br><span class="line"> * relative: å æ®çˆ¶å…ƒç´ ç©ºé—´</span><br><span class="line"> */</span></span><br><span class="line">position	enum&#123;<span class="string">'absolute'</span>, <span class="string">'relative'</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u56FE_u7247_u4F7F_u7528_u7BC7"><a href="#u56FE_u7247_u4F7F_u7528_u7BC7" class="headerlink" title="å›¾ç‰‡ä½¿ç”¨ç¯‡"></a>å›¾ç‰‡ä½¿ç”¨ç¯‡</h2><h3 id="SVG__7C_AI__7C_PNG__7C_JPEG"><a href="#SVG__7C_AI__7C_PNG__7C_JPEG" class="headerlink" title="SVG | AI | PNG | JPEG"></a>SVG | AI | PNG | JPEG</h3><p><strong>SVG:</strong>    (Scalable Vector Graphics) åŸºäºXML, æè¿°äºŒç»´<a href="https://zh.wikipedia.org/wiki/%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%BD%A2" target="_blank" rel="external">çŸ¢é‡å›¾å½¢</a>çš„å›¾å½¢æ ¼å¼ã€‚æ— é™æ”¾å¤§è€Œä¸å½±å“è´¨é‡</p>
<p><strong>AI:</strong>        (Adobe illustrator)çŸ¢é‡å›¾, ä½¿ç”¨Adobe illustratorå›¾å½¢åˆ¶ä½œè½¯ä»¶åšçš„çŸ¢é‡å›¾</p>
<p><strong>PNG:</strong>     (Portable Network Graphics) ä¸€ç§æ— æŸå‹ç¼©çš„ä½å›¾(<a href="https://zh.wikipedia.org/wiki/%E4%BD%8D%E5%9B%BE" target="_blank" rel="external">Bitmap</a>)å›¾å½¢æ ¼å¼, æ–‡ä»¶å¤§</p>
<p><strong>JPEG:</strong>    (Joint Photographic Experts Group)ä¸€ç§é’ˆå¯¹ç…§ç‰‡è§†é¢‘è€Œå¹¿æ³›ä½¿ç”¨çš„ä¸€ç§æœ‰æŸå‹ç¼©æ ‡å‡†æ–¹æ³• </p>
<p>ç›®å‰é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯PNG, æ¯ä¸ªiconéœ€è¦å¤šå¼ ä¸åŒåˆ†è¾¨ç‡çš„PNGå›¾ã€‚å¯ä»¥è€ƒè™‘è½¬å‘SVGé˜µè¥</p>
<p>å¦å¤–æ ¹æ®PMçš„è®¾è®¡, æˆ‘ä»¬çš„å›¾æ ‡è½¬å‘ä½¿ç”¨Googleæä¾›çš„ä¸€å¥—å›¾æ ‡åº“, ç›¸æ¯”äºæ‰‹åŠ¨ä¸‹è½½è¿™äº›å›¾æ ‡, æ¨èä½¿ç”¨</p>
<p>ä¸‹é¢ä»‹ç»çš„iconå·¥å…·, ä¸ä»…è‡ªå¸¦äº†Googleå›¾æ ‡, æ˜“ç”¨æ€§ä¹Ÿå¤§å¤§æé«˜</p>
<h3 id="u597D_u7528_u7684icon_u5DE5_u5177"><a href="#u597D_u7528_u7684icon_u5DE5_u5177" class="headerlink" title="å¥½ç”¨çš„iconå·¥å…·"></a>å¥½ç”¨çš„iconå·¥å…·</h3><ol>
<li><strong><a href="https://github.com/corymsmith/react-native-icons" target="_blank" rel="external">react-native-icons</a></strong></li>
<li><strong><a href="https://github.com/oblador/react-native-vector-icons" target="_blank" rel="external">react-native-vector-icons</a></strong></li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RN/">RN</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/ç‹è´ºé”‹/">ç‹è´ºé”‹</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-JavaScriptBridge" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/01/JavaScriptBridge/" class="article-date">
  	<time datetime="2016-02-01T07:07:42.000Z" itemprop="datePublished">2016-02-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/01/JavaScriptBridge/">JavaScriptBridge</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>è·ŸNativeå¼€å‘ç›¸æ¯”, ç½‘é¡µå¼€å‘è™½ç„¶åœ¨ç”¨æˆ·ä½“éªŒä¸Šè·ŸNativeæœ‰ä¸å°çš„å·®è·, ä½†å…¶åœ¨å¼€å‘å‘¨æœŸã€æ›´æ–°æ–¹å¼ä¸Šå´æœ‰ä¸å¯æ¯”æ‹Ÿçš„ä¼˜åŠ¿ã€‚æœ‰æ—¶ä¸ºäº†å¿«é€Ÿä¸Šçº¿æ–°çš„ä¸šåŠ¡æˆ–åŠ¨æ€æ”¯æŒç¬¬ä¸‰æ–¹çš„ä¸šåŠ¡ï¼ŒAppä¸­ä¸å¯é¿å…çš„ä¼šä½¿ç”¨webviewã€‚ä¸€èˆ¬æƒ…å†µä¸‹, webviewæˆ–å¤šæˆ–å°‘çš„éƒ½ä¼šç”¨åˆ°cookieã€å®šä½ã€æ”¯ä»˜ã€åˆ†äº«ç­‰ä¿¡æ¯æˆ–åŠŸèƒ½ï¼Œè€Œè¿™äº›åŠŸèƒ½å´æ˜¯Native; å¦ä¸€æ–¹é¢ï¼Œç»Ÿä¸€UIäº¤äº’ï¼šé€‰æ‹©åˆ—è¡¨ã€ä¿¡æ¯æç¤ºç­‰å¯¹æå‡ç”¨æˆ·ä½“éªŒä¹Ÿéå¸¸æœ‰å¸®åŠ©ï¼Œç›´æ¥ä½¿ç”¨Nativeæ˜¾ç„¶åˆè¦æ¯”ä½¿ç”¨webæ¥æ¨¡æ‹ŸNativeçš„UIè¦ç®€å•çš„å¤šã€‚ç»¼åˆæ¥çœ‹ï¼Œwebviewè°ƒç”¨Nativeæ¨¡å—å®Œæˆéƒ¨åˆ†äº¤äº’æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•åšåˆ°å‘¢ï¼Ÿ</p>
<h3 id="Native_vs_Web"><a href="#Native_vs_Web" class="headerlink" title="Native vs Web"></a>Native vs Web</h3><p><strong>Appå¼€å‘çš„åŒå­¦ä»¬éƒ½çŸ¥é“ä»äº§å“ä½“éªŒçš„è§’åº¦å‡ºå‘ï¼Œwebviewç»ä¸æ˜¯Appçš„ç¬¬ä¸€é€‰æ‹©ï¼Œè·ŸNativeç›¸æ¯”webviewåœ¨äº§å“ä½“éªŒä¸Šæœ‰ä¸‹é¢å‡ ä¸ªæ–¹é¢çš„ä¸è¶³ï¼š</strong></p>
<ol>
<li>é¡µé¢æ¸²æŸ“æ…¢ã€‚ç½‘é¡µçš„èµ„æºåŠ è½½ã€UIä½ç½®è®¡ç®—ã€æ¸²æŸ“ã€é€»è¾‘è¿ç®—ç­‰éƒ½æ˜¯å•çº¿ç¨‹,æ— æ³•æ¯”æ‹ŸNativeå¤šçº¿ç¨‹</li>
<li>æµç•…æ€§ä¸å¤Ÿå¥½ã€‚eg. ä¸Šä¸‹æ»‘åŠ¨é¡µé¢æ—¶, Nativeçš„æ»šåŠ¨æµç•…æ€§è¦è¿œé«˜äºWebViewï¼Œå¯ä»¥æ‹¿ä¸¤ä¸ªåˆ—è¡¨é¡µè¯•è¯•</li>
<li>æ‰‹åŠ¿çš„æ”¯æŒæ¯”è¾ƒå°‘ã€‚webviewæ”¯æŒçš„æ‰‹åŠ¿è¦æ¯”Nativeå°‘ï¼Œæ¯”å¦‚å¤šç‚¹è§¦æ§ã€ShakeGestureç­‰</li>
<li>å¾ˆéš¾åšåˆ°UIçš„ä¸€è‡´ã€‚ç”¨æˆ·é¦–å…ˆå¯¹ç³»ç»ŸåŸç”Ÿçš„UIæ§ä»¶æ¯”è¾ƒç†Ÿæ‚‰ï¼ŒAppçš„å¼€å‘å¤§éƒ½åŸºäºè¿™äº›åŸºæœ¬çš„æ§ä»¶ã€‚ä½¿ç”¨webviewæ—¶ï¼Œç”±äºä¸èƒ½ç›´æ¥ä½¿ç”¨å¾ˆå¤šNativeåŸç”Ÿæ§ä»¶ï¼Œè€Œç”¨JSå®ç°çš„æ§ä»¶è·ŸåŸç”Ÿåˆæœ‰å·®å¼‚ï¼Œæ‰€ä»¥UIçš„ä¸€è‡´æ€§æ˜¯å¤§æœ‰æŠ˜æ‰£çš„ã€‚å³ä½¿Webæ§ä»¶çš„æ ·å¼è·ŸåŸç”Ÿå·®åˆ«å¾ˆå°ï¼ŒiOS æ¯å¹´çš„ç³»ç»Ÿæ›´æ–°å¸¦æ¥çš„UIè·³è½¬å°±ä¼šç ´åè¿™äº›èŠ±å¤§åŠ›æ°”å®ç°çš„UI</li>
</ol>
<p><strong>ä½†ä»ä¸šåŠ¡çš„è§’åº¦å‡ºå‘ï¼Œæœ‰æ—¶æˆ‘ä»¬ä¸å¾—ä¸é€‰æ‹©ä½¿ç”¨webviewï¼Œè¿™ä¸»è¦åŸºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„è€ƒè™‘ï¼š</strong></p>
<ol>
<li>webviewå¼€å‘å‘¨æœŸçŸ­ï¼Œå¯ä»¥éšæ—¶ä¸Šçº¿æ›´æ–°</li>
<li>å‡ºäºå‘ç‰ˆçš„è€ƒé‡ï¼Œä¸€äº›ä¸šåŠ¡åŠŸèƒ½Nativeå¼€å‘çš„å‘¨æœŸè¿‡é•¿ï¼Œéœ€è¦webviewæ¥å…¥å¿«é€Ÿä¸Šçº¿</li>
<li>æœ‰äº›æœåŠ¡æ¥è‡ªç¬¬ä¸‰æ–¹ï¼ŒAppå¼€å‘è€…æœ¬èº«ä¸éœ€è¦æ”¯æŒè¿™äº›æœåŠ¡, ä½¿ç”¨webviewå±•ç¤ºç¬¬ä¸‰æ–¹æœåŠ¡</li>
</ol>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/ç‹è´ºé”‹/">ç‹è´ºé”‹</a>
	</div>


      
        <p class="article-more-link">
          <a  href="/2016/02/01/JavaScriptBridge/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CFRunLoop" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/26/CFRunLoop/" class="article-date">
  	<time datetime="2016-01-26T09:02:11.000Z" itemprop="datePublished">2016-01-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/26/CFRunLoop/">CFRunLoop</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="u6570_u636E_u7ED3_u6784"><a href="#u6570_u636E_u7ED3_u6784" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p><strong>__CFRunLoopMode</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">struct</span> __CFRunLoopMode &#123;</span><br><span class="line">    CFRuntimeBase _base;</span><br><span class="line">    <span class="keyword">pthread_mutex_t</span> _lock;  <span class="comment">/* must have the run loop locked before locking </span><br><span class="line">    this */</span></span><br><span class="line"><span class="comment">//modeå</span></span><br><span class="line">    CFStringRef _name;</span><br><span class="line">    Boolean _stopped;</span><br><span class="line">    <span class="keyword">char</span> _padding[<span class="number">3</span>];</span><br><span class="line"><span class="comment">//source0 æº</span></span><br><span class="line">    CFMutableSetRef _sources0;</span><br><span class="line"><span class="comment">//source1 æº</span></span><br><span class="line">    CFMutableSetRef _sources1;</span><br><span class="line"><span class="comment">//observer æº</span></span><br><span class="line">    CFMutableArrayRef _observers;</span><br><span class="line"><span class="comment">//timer æº</span></span><br><span class="line">    CFMutableArrayRef _timers;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//mach port åˆ° modeçš„æ˜ å°„,ä¸ºäº†åœ¨runloopä¸»é€»è¾‘ä¸­è¿‡æ»¤runloopè‡ªå·±çš„portæ¶ˆæ¯ã€‚</span></span><br><span class="line">    CFMutableDictionaryRef _portToV1SourceMap;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//è®°å½•äº†æ‰€æœ‰å½“å‰modeä¸­éœ€è¦ç›‘å¬çš„portï¼Œä½œä¸ºè°ƒç”¨ç›‘å¬æ¶ˆæ¯å‡½æ•°çš„å‚æ•°ã€‚</span></span><br><span class="line">    __CFPortSet _portSet;</span><br><span class="line">    CFIndex _observerMask;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> USE_DISPATCH_SOURCE_FOR_TIMERS</span></span><br><span class="line">    <span class="keyword">dispatch_source_t</span> _timerSource;</span><br><span class="line">    <span class="keyword">dispatch_queue_t</span> _queue;</span><br><span class="line">    Boolean _timerFired; <span class="comment">// set to true by the source when a timer has fired</span></span><br><span class="line">    Boolean _dispatchTimerArmed;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> USE_MK_TIMER_TOO</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨ mk timerï¼Œ ç”¨åˆ°çš„mach portï¼Œå’Œsource1ç±»ä¼¼ï¼Œéƒ½ä¾èµ–äºmach port</span></span><br><span class="line">    <span class="keyword">mach_port_t</span> _timerPort;</span><br><span class="line">    Boolean _mkTimerArmed;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">//timerè§¦å‘çš„ç†æƒ³æ—¶é—´</span></span><br><span class="line">    <span class="keyword">uint64_t</span> _timerSoftDeadline; <span class="comment">/* TSR */</span></span><br><span class="line"><span class="comment">//timerè§¦å‘çš„å®é™…æ—¶é—´ï¼Œç†æƒ³æ—¶é—´åŠ ä¸Štoleranceï¼ˆåå·®ï¼‰</span></span><br><span class="line">    <span class="keyword">uint64_t</span> _timerHardDeadline; <span class="comment">/* TSR */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/éƒ‘æ™ºæ–‡/">éƒ‘æ™ºæ–‡</a>
	</div>


      
        <p class="article-more-link">
          <a  href="/2016/01/26/CFRunLoop/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-RunLoopæºç åˆ†æ" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/26/RunLoopæºç åˆ†æ/" class="article-date">
  	<time datetime="2016-01-26T09:02:11.000Z" itemprop="datePublished">2016-01-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/26/RunLoopæºç åˆ†æ/">RunLoopæºç åˆ†æ</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u6570_u636E_u7ED3_u6784"><a href="#u6570_u636E_u7ED3_u6784" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p><strong>__CFRunLoopMode</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">struct</span> __CFRunLoopMode &#123;</span><br><span class="line">    CFRuntimeBase _base;</span><br><span class="line">    <span class="keyword">pthread_mutex_t</span> _lock;  <span class="comment">/* must have the run loop locked before locking this */</span></span><br><span class="line"><span class="comment">//modeå</span></span><br><span class="line">    CFStringRef _name;</span><br><span class="line">    Boolean _stopped;</span><br><span class="line">    <span class="keyword">char</span> _padding[<span class="number">3</span>];</span><br><span class="line"><span class="comment">//source0 æº</span></span><br><span class="line">    CFMutableSetRef _sources0;</span><br><span class="line"><span class="comment">//source1 æº</span></span><br><span class="line">    CFMutableSetRef _sources1;</span><br><span class="line"><span class="comment">//observer æº</span></span><br><span class="line">    CFMutableArrayRef _observers;</span><br><span class="line"><span class="comment">//timer æº</span></span><br><span class="line">    CFMutableArrayRef _timers;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//mach port åˆ° modeçš„æ˜ å°„,ä¸ºäº†åœ¨runloopä¸»é€»è¾‘ä¸­è¿‡æ»¤runloopè‡ªå·±çš„portæ¶ˆæ¯ã€‚</span></span><br><span class="line">    CFMutableDictionaryRef _portToV1SourceMap;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//è®°å½•äº†æ‰€æœ‰å½“å‰modeä¸­éœ€è¦ç›‘å¬çš„portï¼Œä½œä¸ºè°ƒç”¨ç›‘å¬æ¶ˆæ¯å‡½æ•°çš„å‚æ•°ã€‚</span></span><br><span class="line">    __CFPortSet _portSet;</span><br><span class="line">    CFIndex _observerMask;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> USE_DISPATCH_SOURCE_FOR_TIMERS</span></span><br><span class="line">    <span class="keyword">dispatch_source_t</span> _timerSource;</span><br><span class="line">    <span class="keyword">dispatch_queue_t</span> _queue;</span><br><span class="line">    Boolean _timerFired; <span class="comment">// set to true by the source when a timer has fired</span></span><br><span class="line">    Boolean _dispatchTimerArmed;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> USE_MK_TIMER_TOO</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨ mk timerï¼Œ ç”¨åˆ°çš„mach portï¼Œå’Œsource1ç±»ä¼¼ï¼Œéƒ½ä¾èµ–äºmach port</span></span><br><span class="line">    <span class="keyword">mach_port_t</span> _timerPort;</span><br><span class="line">    Boolean _mkTimerArmed;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">//timerè§¦å‘çš„ç†æƒ³æ—¶é—´</span></span><br><span class="line">    <span class="keyword">uint64_t</span> _timerSoftDeadline; <span class="comment">/* TSR */</span></span><br><span class="line"><span class="comment">//timerè§¦å‘çš„å®é™…æ—¶é—´ï¼Œç†æƒ³æ—¶é—´åŠ ä¸Štoleranceï¼ˆåå·®ï¼‰</span></span><br><span class="line">    <span class="keyword">uint64_t</span> _timerHardDeadline; <span class="comment">/* TSR */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/éƒ‘æ™ºæ–‡/">éƒ‘æ™ºæ–‡</a>
	</div>


      
        <p class="article-more-link">
          <a  href="/2016/01/26/RunLoopæºç åˆ†æ/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-RunLoopä»‹ç»" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/26/RunLoopä»‹ç»/" class="article-date">
  	<time datetime="2016-01-26T09:01:31.000Z" itemprop="datePublished">2016-01-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/26/RunLoopä»‹ç»/">RunLoopä»‹ç»</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="RunLoop__u7684_u6982_u5FF5"><a href="#RunLoop__u7684_u6982_u5FF5" class="headerlink" title="RunLoop çš„æ¦‚å¿µ"></a><strong>RunLoop çš„æ¦‚å¿µ</strong></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    initialize();</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        var message = get_next_message();</span><br><span class="line">        process_message(message);</span><br><span class="line">    &#125; <span class="keyword">while</span> (message != quit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/éƒ‘æ™ºæ–‡/">éƒ‘æ™ºæ–‡</a>
	</div>


      
        <p class="article-more-link">
          <a  href="/2016/01/26/RunLoopä»‹ç»/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-hexo-githubæ­å»ºåšå®¢" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/26/hexo-githubæ­å»ºåšå®¢/" class="article-date">
  	<time datetime="2016-01-26T07:00:42.000Z" itemprop="datePublished">2016-01-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/26/hexo-githubæ­å»ºåšå®¢/">hexo+githubæ­å»ºåšå®¢</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>å‰æç¯å¢ƒï¼šnode.js git</p>
<h4 id="1-hexo_u5B89_u88C5"><a href="#1-hexo_u5B89_u88C5" class="headerlink" title="1.hexoå®‰è£…"></a>1.hexoå®‰è£…</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir MyBlog&#10;cd MyBlog&#10;npm install hexo-cli -g&#10;hexo init&#10;npm install&#10;hexo server</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™åº”è¯¥åœ¨consoleä¼šæ˜¾ç¤ºï¼š</p>
<p> Hexo is running at <a href="http://0.0.0.0:4000/">http://0.0.0.0:4000/</a>.</p>
<p>è¿™ä¸ªæ—¶å€™ç›´æ¥è®¿é—®è¯¥åœ°å€ï¼Œå³éƒ¨ç½²åˆ°æœ¬åœ°çš„åšå®¢ï¼š</p>
<p><img src="http://7xqgnx.com1.z0.glb.clouddn.com/localBlog.png" alt="æœ¬åœ°hexoåšå®¢"></p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/éƒ‘æ™ºæ–‡/">éƒ‘æ™ºæ–‡</a>
	</div>


      
        <p class="article-more-link">
          <a  href="/2016/01/26/hexo-githubæ­å»ºåšå®¢/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 MOMA
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>